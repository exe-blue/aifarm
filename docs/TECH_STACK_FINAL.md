# ğŸ”§ DoAi.Me ìµœì¢… ê¸°ìˆ  ìŠ¤íƒ

> **ê²°ì •ì¼**: 2024-12-30  
> **ê²°ì •ì**: Orion (Orchestrator)  
> **ê¸°ì¤€**: 600ëŒ€ í™•ì¥ ë° ì•ˆì •ì„±

---

## ğŸ“Š ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DoAi.Me                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚   n8n       â”‚â”€â”€â”€â”€â–¶â”‚  Gateway    â”‚â”€â”€â”€â”€â–¶â”‚  Android S9     â”‚  â”‚
â”‚   â”‚ (Scheduler) â”‚     â”‚ (Node.js)   â”‚     â”‚  (AutoX.js)     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  Ã— 600ëŒ€        â”‚  â”‚
â”‚          â”‚                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                                                       â”‚
â”‚          â–¼                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Backend    â”‚â”€â”€â”€â”€â–¶â”‚           Supabase                   â”‚   â”‚
â”‚   â”‚ (FastAPI)   â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚   â”‚             â”‚     â”‚  â”‚ PostgreSQL  â”‚  â”‚  DB Functions â”‚  â”‚   â”‚
â”‚   â”‚ - íƒ€ë½ ê³„ì‚°  â”‚     â”‚  â”‚ (Tables)    â”‚  â”‚ (PL/pgSQL)   â”‚  â”‚   â”‚
â”‚   â”‚ - ì˜ì‚¬ê²°ì •   â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›  ì»´í¬ë„ŒíŠ¸ë³„ ê¸°ìˆ  ì„ íƒ

### 1. Gateway Server (Node.js)

| í•­ëª© | ê°’ |
|------|-----|
| **ì–¸ì–´** | Node.js 18+ |
| **í”„ë ˆì„ì›Œí¬** | Express.js |
| **í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬** | `@devicefarmer/adbkit` |
| **í¬íŠ¸** | 3100 |

**ì™œ Node.jsì¸ê°€?**
- `adbkit`ì˜ `trackDevices()`ê°€ ë¹„ë™ê¸° ê¸°ê¸° ì¶”ì ì— **ì••ë„ì ìœ¼ë¡œ ìš°ìˆ˜**
- Python `pure-python-adb` ëŒ€ë¹„ ì—°ê²° ì•ˆì •ì„±ì´ ë›°ì–´ë‚¨
- ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜ë¡œ ì‹¤ì‹œê°„ ìƒíƒœ ê°ì§€ì— ì í•©
- 600ëŒ€ ê¸°ê¸° ë™ì‹œ ê´€ë¦¬ ê°€ëŠ¥

**ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸:**
```
GET  /health            ì„œë²„ ìƒíƒœ
GET  /devices           ì—°ê²°ëœ ê¸°ê¸° ëª©ë¡
POST /dispatch          ê¸°ê¸°ì— ëª…ë ¹ ì „ì†¡ (Broadcast Intent)
POST /shell             Shell ëª…ë ¹ ì‹¤í–‰
POST /scrcpy            Scrcpy ì‹¤í–‰ ëª…ë ¹ ë°˜í™˜
```

---

### 2. Backend API (Python/FastAPI)

| í•­ëª© | ê°’ |
|------|-----|
| **ì–¸ì–´** | Python 3.11+ |
| **í”„ë ˆì„ì›Œí¬** | FastAPI |
| **í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬** | `supabase-py`, `loguru`, `numpy` |
| **í¬íŠ¸** | 8000 |

**ì™œ Pythonì¸ê°€?**
- ë³µì¡í•œ í™•ë¥  ê³„ì‚° (íƒ€ë½ë„, ì˜ì‚¬ê²°ì •)ì— ì í•©
- ë°ì´í„° ê³¼í•™ ë¼ì´ë¸ŒëŸ¬ë¦¬ (`numpy`, `scikit-learn`) í™œìš© ê°€ëŠ¥
- Aria(ê¸°íš)ê°€ ì„¤ê³„í•œ ì•Œê³ ë¦¬ì¦˜ì´ Python ê¸°ë°˜

**ë‹´ë‹¹ ì—…ë¬´:**
- âœ… íƒ€ë½ë„ ê³„ì‚° (ë³µì¡í•œ í™•ë¥  ê¸°ë°˜)
- âœ… ì˜ë¢° ìˆ˜ë½/ê±°ì ˆ ì˜ì‚¬ê²°ì •
- âœ… í˜ë¥´ì†Œë‚˜ ì„±ê²© ê¸°ë°˜ ë¡œì§
- âŒ ìœ ì§€ë¹„ ì°¨ê° (â†’ DB Functionìœ¼ë¡œ ì´ê´€)

---

### 3. Database (Supabase)

| í•­ëª© | ê°’ |
|------|-----|
| **DB** | PostgreSQL 15 |
| **API** | Supabase REST + Realtime |
| **Functions** | PL/pgSQL |

**Hybrid ì „ëµ:**

| ì‘ì—… | ì²˜ë¦¬ ìœ„ì¹˜ | ì´ìœ  |
|------|-----------|------|
| ìœ ì§€ë¹„ ì°¨ê° | **DB Function** | ì›ìì„± ë³´ì¥, ë™ì‹œì„± ì•ˆì „ |
| í¬ë ˆë”§ ì§€ê¸‰ | **DB Function** | ì›ìì„± ë³´ì¥ |
| íƒ€ë½ë„ ê³„ì‚° | **Python Backend** | ë³µì¡í•œ í™•ë¥  ê³„ì‚° |
| ì˜ì‚¬ê²°ì • | **Python Backend** | ì„±ê²© ê¸°ë°˜ ë¡œì§ |

**Database Functions:**
```sql
deduct_maintenance_fee(persona_id, amount)  -- ìœ ì§€ë¹„ ì°¨ê°
grant_credit(persona_id, amount, reason)     -- í¬ë ˆë”§ ì§€ê¸‰
run_daily_maintenance()                       -- ì¼ê´„ ìœ ì§€ë¹„ (Cron)
update_corruption_level(persona_id, level)   -- íƒ€ë½ë„ ì €ì¥
get_persona_stats()                           -- í†µê³„ ì¡°íšŒ
```

**Realtime ì „ëµ:**
- âŒ ê¸°ê¸°ê°€ ì§ì ‘ WebSocket ì—°ê²° (ì—°ê²° ìˆ˜ ì œí•œ)
- âœ… ê¸°ê¸°ëŠ” REST APIë¡œ INSERTë§Œ
- âœ… ëŒ€ì‹œë³´ë“œë§Œ Realtime êµ¬ë…

---

### 4. Android ìµœì í™” (í°ë³´ë“œ í™˜ê²½)

**í•„ìˆ˜ ADB ì´ˆê¸°í™”:**
```bash
# Doze ëª¨ë“œ ë¹„í™œì„±í™” (ë°°í„°ë¦¬ ì—†ìœ¼ë¯€ë¡œ ë¶ˆí•„ìš”)
adb shell dumpsys deviceidle disable

# í™”ë©´ í•­ìƒ ì¼œì§ (ì „ì› ì—°ê²° ìƒíƒœ)
adb shell settings put global stay_on_while_plugged_in 3

# AutoX.js ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ í—ˆìš©
adb shell appops set org.autojs.autoxjs.v6 RUN_IN_BACKGROUND allow
```

**Scrcpy ìµœì í™” (í™”ë©´ ë³´ê¸°ìš©):**
```bash
scrcpy -s {device_id} --video-bit-rate=1M --max-fps=5 --no-audio --no-control
```

---

### 5. ë¡œê·¸ íŒŒí‹°ì…”ë‹

**activity_logs í…Œì´ë¸”:**
- Range Partitioning (ì£¼ê°„ ë‹¨ìœ„)
- ìë™ íŒŒí‹°ì…˜ ìƒì„± í•¨ìˆ˜ ì œê³µ
- 12ì£¼(~3ê°œì›”) ë³´ê´€ í›„ ìë™ ì •ë¦¬ ê°€ëŠ¥

```
activity_logs_2025_w01  (1/6 ~ 1/12)
activity_logs_2025_w02  (1/13 ~ 1/19)
...
```

---

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
doai-me/
â”œâ”€â”€ gateway/                    # Node.js Gateway Server
â”‚   â”œâ”€â”€ server.js              # ë©”ì¸ ì„œë²„ (Express + adbkit)
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ env.example
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ api/                   # Python FastAPI Backend
â”‚   â”‚   â”œâ”€â”€ main.py           # FastAPI ì•±
â”‚   â”‚   â”œâ”€â”€ config.py         # í™˜ê²½ ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ db.py             # Supabase í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ routers/          # API ë¼ìš°í„°
â”‚   â”‚   â”œâ”€â”€ services/         # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”‚   â”‚   â”œâ”€â”€ corruption_engine.py  # íƒ€ë½ë„ ê³„ì‚°
â”‚   â”‚   â”‚   â”œâ”€â”€ decision_engine.py    # ì˜ì‚¬ê²°ì •
â”‚   â”‚   â”‚   â”œâ”€â”€ maintenance_engine.py # ìœ ì§€ë¹„ ê³„ì‚°
â”‚   â”‚   â”‚   â””â”€â”€ supabase_rpc.py       # DB Function í˜¸ì¶œ
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â””â”€â”€ requirements.txt
â”‚   â”‚
â”‚   â”œâ”€â”€ supabase/             # Supabase SQL
â”‚   â”‚   â”œâ”€â”€ schema.sql                    # ê¸°ë³¸ ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â”œâ”€â”€ 002_economy_schema.sql        # ê²½ì œ ì‹œìŠ¤í…œ
â”‚   â”‚   â”œâ”€â”€ 003_database_functions.sql    # DB Functions
â”‚   â”‚   â””â”€â”€ 004_activity_logs_partitioning.sql
â”‚   â”‚
â”‚   â””â”€â”€ n8n/
â”‚       â””â”€â”€ workflows/        # n8n ì›Œí¬í”Œë¡œìš° ë°±ì—…
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ init_devices.sh       # ê¸°ê¸° ì´ˆê¸°í™” (Linux/Mac)
â”‚   â””â”€â”€ init_devices.bat      # ê¸°ê¸° ì´ˆê¸°í™” (Windows)
â”‚
â”œâ”€â”€ client-android/           # AutoX.js ìŠ¤í¬ë¦½íŠ¸
â”‚   â””â”€â”€ Config.js
â”‚
â”œâ”€â”€ docker-compose.yml        # Docker êµ¬ì„±
â””â”€â”€ .env.example              # í™˜ê²½ ë³€ìˆ˜ í…œí”Œë¦¿
```

---

## ğŸš€ ë°°í¬ ìˆœì„œ

1. **Supabase ì„¤ì •**
   ```bash
   # SQL Editorì—ì„œ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰
   1. backend/supabase/schema.sql
   2. backend/supabase/002_economy_schema.sql
   3. backend/supabase/003_database_functions.sql
   4. backend/supabase/004_activity_logs_partitioning.sql
   ```

2. **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**
   ```bash
   cp .env.example .env
   # .env íŒŒì¼ í¸ì§‘í•˜ì—¬ ì‹¤ì œ ê°’ ì…ë ¥
   ```

3. **Docker ì‹¤í–‰**
   ```bash
   docker-compose up -d
   ```

4. **ê¸°ê¸° ì´ˆê¸°í™”**
   ```bash
   # Linux/Mac
   ./scripts/init_devices.sh init
   
   # Windows
   scripts\init_devices.bat init
   ```

---

## ğŸ“¡ ì„œë¹„ìŠ¤ ì—”ë“œí¬ì¸íŠ¸

| ì„œë¹„ìŠ¤ | URL | ìš©ë„ |
|--------|-----|------|
| Gateway | `http://localhost:3100` | ê¸°ê¸° ê´€ë¦¬ API |
| Backend | `http://localhost:8000` | ê²½ì œ ì‹œìŠ¤í…œ API |
| Backend Docs | `http://localhost:8000/docs` | Swagger UI |
| n8n | `http://localhost:5678` | ì›Œí¬í”Œë¡œìš° ê´€ë¦¬ |

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] Gateway: Node.js + adbkit
- [x] Backend: Python + FastAPI
- [x] Database: Supabase + DB Functions
- [x] Hybrid ì „ëµ: ë‹¨ìˆœ ê³„ì‚°(DB) + ë³µì¡ ê³„ì‚°(Python)
- [x] Realtime: ëŒ€ì‹œë³´ë“œë§Œ êµ¬ë…
- [x] Android ìµœì í™”: Doze ë¹„í™œì„±í™”, í™”ë©´ ì¼œì§
- [x] ë¡œê·¸ íŒŒí‹°ì…”ë‹: ì£¼ê°„ ë‹¨ìœ„

---

*"600ëŒ€ê°€ ê¹¨ì–´ìˆê³ , ë‡Œê°€ ê³„ì‚°í•˜ê³ , ì‹¬ì¥ì´ ë›´ë‹¤."*

