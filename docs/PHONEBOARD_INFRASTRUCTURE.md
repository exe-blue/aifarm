# 600대 폰보드 WiFi 인프라 구축 최종 문서

## 목차
1. [장비 주문표](#1-장비-주문표)
2. [네트워크 연결 설계](#2-네트워크-연결-설계)
3. [랙 설치 주의사항](#3-랙-설치-주의사항)
4. [연결 방식 비교 분석](#4-연결-방식-비교-분석)
5. [폰보드 제어 자동화 시스템](#5-폰보드-제어-자동화-시스템)
6. [최종 요약](#6-최종-요약)

---

## 1. 장비 주문표

### 네트워크 장비

| No. | 품목 | 모델명 | 수량 | 단가 | 소계 | 구매처 |
|-----|------|--------|------|------|------|--------|
| 1 | PoE 스위치 | TP-Link TL-SG2210P (10포트) | 1 | ₩180,000 | ₩180,000 | 쿠팡/네이버 |
| 2 | Access Point | TP-Link EAP670 (WiFi 6 AX5400) | 6 | ₩230,000 | ₩1,380,000 | 쿠팡/네이버 |
| 3 | AP 천장 마운트 | TP-Link 천장 브라켓 (EAP용) | 6 | ₩15,000 | ₩90,000 | 네이버 |
| 4 | CAT6 케이블 | 10m PoE 지원 | 6 | ₩8,000 | ₩48,000 | 다이소/쿠팡 |
| 5 | CAT6 케이블 | 2m (서버-스위치) | 3 | ₩3,000 | ₩9,000 | 다이소/쿠팡 |

**소계: ₩1,707,000**

### 서버 장비

| No. | 품목 | 모델명 | 수량 | 단가 | 소계 | 구매처 |
|-----|------|--------|------|------|------|--------|
| 6 | CPU | AMD Ryzen 7 7700X | 1 | ₩350,000 | ₩350,000 | 컴퓨존 |
| 7 | 메인보드 | ASUS TUF B650-PLUS | 1 | ₩220,000 | ₩220,000 | 컴퓨존 |
| 8 | RAM | DDR5 32GB x2 (64GB) | 1 | ₩180,000 | ₩180,000 | 컴퓨존 |
| 9 | SSD | Samsung 990 Pro 1TB | 1 | ₩140,000 | ₩140,000 | 쿠팡 |
| 10 | PSU | Seasonic 550W Gold | 1 | ₩90,000 | ₩90,000 | 컴퓨존 |
| 11 | 케이스 | 4U 랙마운트 케이스 | 1 | ₩120,000 | ₩120,000 | 네이버 |

**소계: ₩1,100,000**

### 전원/보호 장비

| No. | 품목 | 모델명 | 수량 | 단가 | 소계 | 구매처 |
|-----|------|--------|------|------|------|--------|
| 12 | UPS | APC BX1500M-KR (1500VA) | 1 | ₩200,000 | ₩200,000 | 쿠팡 |
| 13 | PDU | 랙마운트 8구 서지보호 | 2 | ₩50,000 | ₩100,000 | 네이버 |
| 14 | 멀티탭 | 산업용 10구 (접지) | 4 | ₩25,000 | ₩100,000 | 쿠팡 |

**소계: ₩400,000**

### 총 비용

| 카테고리 | 금액 |
|----------|------|
| 네트워크 장비 | ₩1,707,000 |
| 서버 장비 | ₩1,100,000 |
| 전원/보호 장비 | ₩400,000 |
| **총계** | **₩3,207,000** |
| 예비비 (10%) | ₩320,700 |
| **최종 예산** | **₩3,527,700** |

---

## 2. 네트워크 연결 설계

### 물리적 토폴로지

```
                         ┌─────────────────────┐
                         │     인터넷/WAN      │
                         │   (외부 프록시)      │
                         └──────────┬──────────┘
                                    │
                                    │ RJ45
                                    ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                                                                          │
│                      TL-SG2210P (PoE 스위치)                             │
│   ┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┐                   │
│   │ P1 │ P2 │ P3 │ P4 │ P5 │ P6 │ P7 │ P8 │ P9 │P10 │                   │
│   │PoE │PoE │PoE │PoE │PoE │PoE │PoE │PoE │    │    │                   │
│   └─┬──┴─┬──┴─┬──┴─┬──┴─┬──┴─┬──┴────┴─┬──┴────┴─┬──┘                   │
│     │    │    │    │    │    │         │         │                       │
└─────┼────┼────┼────┼────┼────┼─────────┼─────────┼───────────────────────┘
      │    │    │    │    │    │         │         │
      ▼    ▼    ▼    ▼    ▼    ▼         ▼         ▼
    ┌───┐┌───┐┌───┐┌───┐┌───┐┌───┐    ┌────┐   ┌─────┐
    │AP1││AP2││AP3││AP4││AP5││AP6│    │서버│   │ WAN │
    └─┬─┘└─┬─┘└─┬─┘└─┬─┘└─┬─┘└─┬─┘    └────┘   │Uplink│
      │    │    │    │    │    │               └─────┘
      │    │    │    │    │    │
   ~~~│~~~~│~~~~│~~~~│~~~~│~~~~│~~~  WiFi 5GHz
      │    │    │    │    │    │
      ▼    ▼    ▼    ▼    ▼    ▼
    100대 100대 100대 100대 100대 100대  = 600대 폰보드
```

### 포트 할당표

| 포트 | 연결 장비 | PoE | VLAN | 비고 |
|------|----------|-----|------|------|
| P1 | AP1 (EAP670) | ✓ | 10 | 폰보드 1~100 담당 |
| P2 | AP2 (EAP670) | ✓ | 10 | 폰보드 101~200 담당 |
| P3 | AP3 (EAP670) | ✓ | 10 | 폰보드 201~300 담당 |
| P4 | AP4 (EAP670) | ✓ | 10 | 폰보드 301~400 담당 |
| P5 | AP5 (EAP670) | ✓ | 10 | 폰보드 401~500 담당 |
| P6 | AP6 (EAP670) | ✓ | 10 | 폰보드 501~600 담당 |
| P7 | (예비) | ✓ | - | AP 장애 시 교체용 |
| P8 | 관리 서버 | - | 1 | ADB 제어 서버 |
| P9 | (예비) | - | - | 확장용 |
| P10 | WAN Uplink | - | - | 인터넷 연결 |

### WiFi 설정

```yaml
# Omada Controller 설정

ssid_config:
  name: "AIFarm-5G"
  security: WPA2-PSK
  password: "[강력한 비밀번호]"
  band: 5GHz-only
  vlan: 10
  
ap_settings:
  channel_width: 40MHz
  tx_power: Auto
  client_limit: 110  # 100 + 여유 10%
  band_steering: disabled
  
channel_assignment:
  AP1: 36
  AP2: 52
  AP3: 100
  AP4: 116
  AP5: 132
  AP6: 149
  # 모든 AP 서로 다른 채널 → 간섭 제로
  
dhcp_config:
  range: 10.0.10.1 ~ 10.0.12.254
  # 600대 + 여유 = 약 700개 IP
  lease_time: 7days
```

### IP 주소 체계

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   네트워크 대역: 10.0.0.0/16                                    │
│                                                                 │
│   관리망 (VLAN 1):                                              │
│   - 10.0.1.1    : 관리 서버                                     │
│   - 10.0.1.2    : PoE 스위치                                    │
│   - 10.0.1.10~15: AP1~AP6 관리 IP                               │
│                                                                 │
│   폰보드망 (VLAN 10):                                           │
│   - 10.0.10.1~254  : 폰보드 001~254                             │
│   - 10.0.11.1~254  : 폰보드 255~508                             │
│   - 10.0.12.1~92   : 폰보드 509~600                             │
│                                                                 │
│   DHCP 예약 (MAC 기반):                                         │
│   - 폰보드별 고정 IP 할당 권장                                   │
│   - 재부팅 시에도 동일 IP 유지                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. 랙 설치 주의사항 (타 팀 전달용)

### 서버 랙 (12U 이상)

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   서버 랙 요구사항                                               │
│                                                                 │
│   1. 크기                                                       │
│      - 최소 12U (권장 15U)                                      │
│      - 깊이 600mm 이상                                          │
│      - 표준 19인치 규격                                         │
│                                                                 │
│   2. 전원                                                       │
│      - 220V 16A 회로 1개 이상                                   │
│      - 접지 필수                                                │
│      - UPS 연결 공간 확보                                       │
│                                                                 │
│   3. 배치                                                       │
│      ┌─────────────────────────────────┐                       │
│      │ 12U: (여유)                     │                       │
│      │ 11U: (여유)                     │                       │
│      │ 10U: 냉각 팬 (옵션)             │                       │
│      │ 9U~6U: 관리 서버 (4U)           │                       │
│      │ 5U: PoE 스위치 (1U)             │                       │
│      │ 4U: (여유)                      │                       │
│      │ 3U: UPS (2U)                    │                       │
│      │ 1U: PDU                         │                       │
│      └─────────────────────────────────┘                       │
│                                                                 │
│   4. 냉각                                                       │
│      - 전면 흡기, 후면 배기                                     │
│      - 주변 온도 25°C 이하 유지                                 │
│      - 서버 발열 약 300W 고려                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 폰보드 경량렉 (5개)

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   경량렉 요구사항                                                │
│                                                                 │
│   1. 내부 치수                                                  │
│      - 너비: 45cm 이상 (폰보드 43cm)                            │
│      - 깊이: 36cm 이상 (폰보드 34cm)                            │
│      - 높이: 60cm 이상 (6단 × 9cm + 여유)                       │
│                                                                 │
│   2. 선반                                                       │
│      - 6단 구성                                                 │
│      - 선반 간격: 10cm (폰보드 9cm + 통풍 1cm)                  │
│      - 선반당 하중: 10kg 이상 (폰보드 약 3~5kg 추정)            │
│                                                                 │
│   3. 통풍                                                       │
│      ┌─────────────────────────────────┐                       │
│      │ ▲▲▲ 상부 배기 ▲▲▲             │                       │
│      │ ┌─────────────────────────────┐ │                       │
│      │ │ ○○○ 폰보드 ○○○             │ │ ← 측면 통풍구        │
│      │ ├─────────────────────────────┤ │                       │
│      │ │ ○○○ 폰보드 ○○○             │ │                       │
│      │ ├─────────────────────────────┤ │                       │
│      │ │ ...                         │ │                       │
│      │ └─────────────────────────────┘ │                       │
│      │ ▼▼▼ 하부 흡기 (개방) ▼▼▼       │                       │
│      └─────────────────────────────────┘                       │
│                                                                 │
│   4. 전원                                                       │
│      - 렉당 PDU 또는 멀티탭 1개                                 │
│      - 폰보드 6대 × 약 50W = 렉당 300W                          │
│      - 총 1,500W (5개 렉)                                       │
│                                                                 │
│   5. 배치 간격                                                  │
│      - 렉 간 5~10cm 이격 (통풍)                                 │
│      - 벽면에서 10cm 이상 이격                                  │
│      - AP와 렉 간 거리 2m 이내 권장                             │
│                                                                 │
│   6. 케이블 정리                                                 │
│      - 전원 케이블: 후면 정리                                   │
│      - WiFi이므로 데이터 케이블 없음 (장점)                     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 전체 공간 배치

```
    12m
  ◄───────────────────────────────────────────────────────────────►
  
  ┌───────────────────────────────────────────────────────────────┐
  │                                                               │  ▲
  │   ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐       ┌──────┐          │  │
  │   │렉1 │ │렉2 │ │렉3 │ │렉4 │ │렉5 │       │ 서버 │          │  │
  │   │    │ │    │ │    │ │    │ │    │       │  랙  │          │  │
  │   │120 │ │120 │ │120 │ │120 │ │120 │       │      │          │  │
  │   └────┘ └────┘ └────┘ └────┘ └────┘       └──────┘          │  │ 3m
  │    ◉      ◉      ◉      ◉      ◉       ◉                     │  │
  │   AP1    AP2    AP3    AP4    AP5     AP6                    │  │
  │                                                               │  │
  │   ══════════════════ 통로 80cm ══════════   ┌─────────┐      │  │
  │                                             │ 사무용  │      │  │
  │   전원인입 ●────────────────────────────    └─────────┘      │  ▼
  └───────────────────────────────────────────────────────────────┘
  
  주의:
  - AP는 각 렉 상단 천장에 설치 (높이 2.5m)
  - AP6은 서버 랙 근처에 배치 (관리 편의)
  - 전원 인입점에서 각 렉까지 배선 경로 확보
```

---

## 4. 연결 방식 비교 분석

### 연결 방식별 특성

| 항목 | WiFi (ADB TCP) | USB 직접 연결 | OTG 연결 |
|------|----------------|---------------|----------|
| **연결 방식** | 무선 네트워크 | USB 케이블 | USB-C to USB-A |
| **대역폭** | ~100Mbps | 480Mbps | 480Mbps |
| **지연시간** | 10~30ms | 1~5ms | 1~5ms |
| **케이블** | 없음 | 600개 필요 | 600개 필요 |
| **허브 필요** | 없음 | 다수 필요 | 다수 필요 |
| **PC 필요** | 1대 | 15~30대 | 15~30대 |
| **확장성** | AP 추가만 | 물리적 한계 | 물리적 한계 |
| **장애 영향** | AP 단위 (100대) | 허브 단위 | 허브 단위 |
| **초기 비용** | 낮음 | 높음 | 높음 |
| **유지보수** | 쉬움 | 어려움 | 어려움 |

### USB 직접 연결의 문제점

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   USB 연결 시 문제점                                             │
│                                                                 │
│   1. 물리적 한계                                                 │
│      - USB 컨트롤러당 127대 제한                                │
│      - PC당 컨트롤러 2~4개 = 최대 500대                         │
│      - 600대 연결 시 최소 PC 2대 필요                           │
│                                                                 │
│   2. 허브 계층화 문제                                            │
│      - 허브 4단 이상 연결 시 불안정                              │
│      - 대역폭 분할로 속도 저하                                   │
│      - 전원 부족 현상                                            │
│                                                                 │
│   3. 케이블 관리                                                 │
│      - 600개 USB 케이블 정리 불가                               │
│      - 접촉 불량, 단선 빈번                                     │
│      - 교체 시 전체 중단 위험                                   │
│                                                                 │
│   4. 비용                                                       │
│      - USB 허브: 60개 × ₩30,000 = ₩1,800,000                   │
│      - USB 케이블: 600개 × ₩3,000 = ₩1,800,000                 │
│      - 추가 PC: 15대 × ₩400,000 = ₩6,000,000                   │
│      - 총: 약 ₩9,600,000 (WiFi의 3배)                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### OTG 연결의 문제점

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   OTG 연결 시 문제점                                             │
│                                                                 │
│   1. 폰보드 구조적 한계                                          │
│      - 폰보드는 보드만 있음 (외부 포트 없음)                     │
│      - OTG 연결점이 내부에 있어 접근 불가                       │
│      - 분해 불가 구조                                           │
│                                                                 │
│   2. 동시 연결 문제                                              │
│      - OTG 사용 시 충전 불가 (일부 기기)                        │
│      - 전원 공급과 데이터 전송 충돌                             │
│                                                                 │
│   3. 호환성                                                     │
│      - 모든 기기가 OTG 지원하지 않음                            │
│      - Galaxy S9 기준 OTG 지원하나 폰보드에서 접근 불가         │
│                                                                 │
│   → 결론: 폰보드 환경에서 OTG는 사실상 불가능                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 연결 방식 비용 비교

| 항목 | WiFi | USB | OTG |
|------|------|-----|-----|
| 네트워크 장비 | ₩1,700,000 | ₩200,000 | ₩200,000 |
| 서버/PC | ₩1,100,000 | ₩6,000,000 | ₩6,000,000 |
| 허브/케이블 | ₩0 | ₩3,600,000 | ₩3,600,000 |
| 전원 장비 | ₩400,000 | ₩800,000 | ₩800,000 |
| **총 비용** | **₩3,200,000** | **₩10,600,000** | **불가** |
| 관리 복잡도 | 낮음 | 매우 높음 | - |
| 확장성 | 우수 | 제한적 | - |

### 최종 선택: WiFi (ADB over TCP)

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   WiFi 선택 이유                                                 │
│                                                                 │
│   ✓ 비용: USB 대비 70% 절감                                     │
│   ✓ 관리: 케이블 없음, 단일 서버 운용                           │
│   ✓ 확장: AP 추가만으로 무한 확장                               │
│   ✓ 안정성: 물리적 접촉 장애 없음                               │
│   ✓ 폰보드 호환: WiFi 모드 공식 지원                            │
│                                                                 │
│   단점 (감수 가능):                                              │
│   - USB 대비 10~30ms 지연 (YouTube 자동화에 무의미)             │
│   - 초기 WiFi 설정 필요 (1회성)                                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 5. 폰보드 제어 자동화 시스템

### 전체 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│                         AIFarm 제어 시스템                                   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        관리 서버                                     │   │
│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────────────┐   │   │
│  │  │   FastAPI     │  │   Supabase    │  │   xiaowei API Client  │   │   │
│  │  │   Backend     │◄─┤   Database    │  │   (폰보드 제어)        │   │   │
│  │  └───────┬───────┘  └───────────────┘  └───────────┬───────────┘   │   │
│  │          │                                         │               │   │
│  │          │         ┌───────────────┐               │               │   │
│  │          └────────►│  ADB Manager  │◄──────────────┘               │   │
│  │                    │  (600대 연결)  │                               │   │
│  │                    └───────┬───────┘                               │   │
│  └────────────────────────────┼───────────────────────────────────────┘   │
│                               │                                           │
│                               │ ADB over TCP (WiFi)                       │
│                               ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        WiFi 네트워크                                 │   │
│  │                                                                     │   │
│  │    ◉ AP1      ◉ AP2      ◉ AP3      ◉ AP4      ◉ AP5      ◉ AP6    │   │
│  │      │          │          │          │          │          │      │   │
│  │      ▼          ▼          ▼          ▼          ▼          ▼      │   │
│  │   ┌────┐     ┌────┐     ┌────┐     ┌────┐     ┌────┐     ┌────┐   │   │
│  │   │100대│     │100대│     │100대│     │100대│     │100대│     │100대│   │   │
│  │   └────┘     └────┘     └────┘     └────┘     └────┘     └────┘   │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 제어 흐름

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   1단계: 폰보드 WiFi 초기 설정 (1회성)                                       │
│                                                                             │
│   ┌─────────────┐      ┌─────────────────┐      ┌─────────────────┐        │
│   │ xiaowei     │      │    폰보드       │      │    WiFi AP      │        │
│   │ 제어 SW     │─────►│   (20대/유닛)   │─────►│   (자동 연결)   │        │
│   └─────────────┘      └─────────────────┘      └─────────────────┘        │
│         │                                                                   │
│         │ "WiFi 모드" 명령                                                  │
│         │ "핸드폰 WiFi 연결" → SSID/PW 설정                                │
│         ▼                                                                   │
│   ┌─────────────────────────────────────────────────────────────────┐      │
│   │                                                                 │      │
│   │   xiaowei 제어 프로그램 기능:                                    │      │
│   │   - WiFi 모드 활성화                                            │      │
│   │   - SSID/비밀번호 일괄 설정                                     │      │
│   │   - ADB TCP 모드 활성화 (adb tcpip 5555)                        │      │
│   │   - 디바이스 상태 모니터링                                       │      │
│   │                                                                 │      │
│   └─────────────────────────────────────────────────────────────────┘      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   2단계: ADB 연결 및 제어 (상시)                                             │
│                                                                             │
│   ┌─────────────────┐                                                       │
│   │   관리 서버     │                                                       │
│   │                 │                                                       │
│   │  ┌───────────┐  │      ADB connect 10.0.10.x:5555                      │
│   │  │ ADB       │──┼──────────────────────────────────►  폰보드 #1~600    │
│   │  │ Manager   │  │                                                       │
│   │  └───────────┘  │                                                       │
│   │        │        │                                                       │
│   │        ▼        │                                                       │
│   │  ┌───────────┐  │                                                       │
│   │  │uiautomator│  │      UI 자동화 명령                                   │
│   │  │    2      │──┼──────────────────────────────────►  앱 제어          │
│   │  └───────────┘  │                                                       │
│   │        │        │                                                       │
│   │        ▼        │                                                       │
│   │  ┌───────────┐  │                                                       │
│   │  │ YouTube   │  │      영상 업로드, 시청, 댓글 등                        │
│   │  │ Agent     │──┼──────────────────────────────────►  YouTube 자동화   │
│   │  └───────────┘  │                                                       │
│   │                 │                                                       │
│   └─────────────────┘                                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 자동화 코드 구조

```python
# /aifarm/phoneboard_manager.py

import asyncio
import httpx
from dataclasses import dataclass
from typing import List, Dict

@dataclass
class PhoneBoard:
    """폰보드 유닛 (20대 내장)"""
    unit_id: str
    ip_range: List[str]  # 20개 IP
    ap_id: str
    status: str = "offline"

class XiaoweiAPIClient:
    """xiaowei 제조사 API 클라이언트"""
    
    def __init__(self, api_base: str):
        self.api = api_base
        self.client = httpx.AsyncClient()
    
    async def enable_wifi_mode(self, unit_id: str) -> bool:
        """WiFi 모드 활성화"""
        response = await self.client.post(
            f"{self.api}/device/{unit_id}/wifi-mode",
            json={"enable": True}
        )
        return response.status_code == 200
    
    async def connect_wifi(self, unit_id: str, ssid: str, password: str) -> bool:
        """WiFi 네트워크 연결"""
        response = await self.client.post(
            f"{self.api}/device/{unit_id}/wifi-connect",
            json={
                "ssid": ssid,
                "password": password,
                "auto_connect": True
            }
        )
        return response.status_code == 200
    
    async def enable_adb_tcp(self, unit_id: str, port: int = 5555) -> bool:
        """ADB TCP 모드 활성화"""
        response = await self.client.post(
            f"{self.api}/device/{unit_id}/adb-tcp",
            json={"port": port}
        )
        return response.status_code == 200
    
    async def get_device_ips(self, unit_id: str) -> List[str]:
        """폰보드 내 20대 디바이스 IP 조회"""
        response = await self.client.get(
            f"{self.api}/device/{unit_id}/devices"
        )
        return response.json().get("ips", [])


class AIFarmController:
    """600대 폰보드 통합 제어"""
    
    def __init__(self):
        self.xiaowei = XiaoweiAPIClient("http://localhost:8080/xiaowei")
        self.phoneboards: List[PhoneBoard] = []
        self.connected_devices: Dict[str, str] = {}  # ip -> adb_id
    
    async def initialize_all(self, ssid: str, password: str):
        """전체 폰보드 초기화 (1회성)"""
        print("=== AIFarm 초기화 시작 ===")
        
        for i in range(30):  # 30개 폰보드 유닛
            unit_id = f"PB{i+1:03d}"
            
            # 1. WiFi 모드 활성화
            await self.xiaowei.enable_wifi_mode(unit_id)
            print(f"[{unit_id}] WiFi 모드 활성화")
            
            # 2. WiFi 연결
            await self.xiaowei.connect_wifi(unit_id, ssid, password)
            print(f"[{unit_id}] WiFi 연결: {ssid}")
            
            # 3. ADB TCP 활성화
            await self.xiaowei.enable_adb_tcp(unit_id)
            print(f"[{unit_id}] ADB TCP 활성화")
            
            # 4. 디바이스 IP 수집
            ips = await self.xiaowei.get_device_ips(unit_id)
            
            self.phoneboards.append(PhoneBoard(
                unit_id=unit_id,
                ip_range=ips,
                ap_id=f"AP{(i // 5) + 1}"  # 5개 유닛당 1개 AP
            ))
            
            await asyncio.sleep(0.5)  # 과부하 방지
        
        print(f"=== 초기화 완료: {len(self.phoneboards)}개 유닛 ===")
    
    async def connect_all_adb(self):
        """전체 디바이스 ADB 연결"""
        print("=== ADB 연결 시작 ===")
        
        tasks = []
        for pb in self.phoneboards:
            for ip in pb.ip_range:
                tasks.append(self._connect_adb(ip))
        
        # 50개씩 배치 처리
        for i in range(0, len(tasks), 50):
            batch = tasks[i:i+50]
            results = await asyncio.gather(*batch, return_exceptions=True)
            success = sum(1 for r in results if r is True)
            print(f"배치 {i//50 + 1}: {success}/{len(batch)} 연결 성공")
            await asyncio.sleep(1)
        
        print(f"=== ADB 연결 완료: {len(self.connected_devices)}대 ===")
    
    async def _connect_adb(self, ip: str) -> bool:
        """단일 디바이스 ADB 연결"""
        proc = await asyncio.create_subprocess_exec(
            'adb', 'connect', f'{ip}:5555',
            stdout=asyncio.subprocess.PIPE,
            stderr=asyncio.subprocess.PIPE
        )
        stdout, _ = await proc.communicate()
        
        if b'connected' in stdout:
            self.connected_devices[ip] = f'{ip}:5555'
            return True
        return False
    
    async def execute_on_all(self, command: str):
        """전체 디바이스에 명령 실행"""
        tasks = []
        for ip, adb_id in self.connected_devices.items():
            tasks.append(self._execute_adb(adb_id, command))
        
        results = await asyncio.gather(*tasks, return_exceptions=True)
        success = sum(1 for r in results if r is not None)
        print(f"명령 실행 완료: {success}/{len(tasks)}")
        return results
    
    async def _execute_adb(self, adb_id: str, command: str) -> str:
        """단일 디바이스 ADB 명령 실행"""
        proc = await asyncio.create_subprocess_exec(
            'adb', '-s', adb_id, 'shell', command,
            stdout=asyncio.subprocess.PIPE,
            stderr=asyncio.subprocess.PIPE
        )
        stdout, _ = await proc.communicate()
        return stdout.decode()


# 실행 예시
async def main():
    controller = AIFarmController()
    
    # 1회성 초기화
    await controller.initialize_all(
        ssid="AIFarm-5G",
        password="secure_password_here"
    )
    
    # ADB 연결
    await controller.connect_all_adb()
    
    # 테스트 명령
    await controller.execute_on_all("input tap 500 500")

if __name__ == "__main__":
    asyncio.run(main())
```

### xiaowei 제조사 프로그램 연동

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   xiaowei 제어 프로그램 자동화                                               │
│                                                                             │
│   제조사 제공 기능:                                                          │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                                                                     │   │
│   │   1. WiFi 모드                                                      │   │
│   │      - 전체 디바이스 WiFi 활성화                                    │   │
│   │      - API: POST /wifi-mode {"enable": true}                       │   │
│   │                                                                     │   │
│   │   2. 핸드폰 WiFi 연결                                               │   │
│   │      - SSID/비밀번호 일괄 설정                                      │   │
│   │      - API: POST /wifi-connect {"ssid": "...", "password": "..."}  │   │
│   │                                                                     │   │
│   │   3. 디바이스 관리                                                   │   │
│   │      - 개별 디바이스 IP 조회                                        │   │
│   │      - 상태 모니터링                                                │   │
│   │      - API: GET /devices                                           │   │
│   │                                                                     │   │
│   │   4. ADB 설정                                                       │   │
│   │      - TCP 모드 전환                                                │   │
│   │      - API: POST /adb-tcp {"port": 5555}                           │   │
│   │                                                                     │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│   자동화 연동 방식:                                                          │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                                                                     │   │
│   │   Option A: REST API 직접 호출 (권장)                               │   │
│   │   - xiaowei 프로그램이 API 서버 제공 시                             │   │
│   │   - Python httpx로 직접 통신                                        │   │
│   │                                                                     │   │
│   │   Option B: GUI 자동화                                              │   │
│   │   - pyautogui로 xiaowei 프로그램 UI 제어                            │   │
│   │   - 안정성 낮음, 최후 수단                                          │   │
│   │                                                                     │   │
│   │   Option C: 설정 파일 직접 수정                                     │   │
│   │   - xiaowei 설정 파일 위치 파악 후 직접 편집                        │   │
│   │   - 프로그램 재시작 필요                                            │   │
│   │                                                                     │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. 최종 요약

### 구축 비용

| 항목 | 금액 |
|------|------|
| 네트워크 장비 | ₩1,707,000 |
| 서버 장비 | ₩1,100,000 |
| 전원/보호 장비 | ₩400,000 |
| **총계** | **₩3,207,000** |

### 선택된 구성

| 항목 | 선택 | 이유 |
|------|------|------|
| 연결 방식 | **WiFi (ADB TCP)** | 비용 70% 절감, 관리 용이 |
| AP | EAP670 × 6대 | 100대/AP, 안정적 운용 |
| 서버 | Ryzen 7 단일 서버 | 600대 ADB 제어 충분 |
| 제어 | xiaowei API + uiautomator2 | 제조사 공식 지원 |

### 데이터 흐름

```
xiaowei 제어 프로그램
        │
        │ WiFi 모드 활성화
        │ SSID/PW 설정
        │ ADB TCP 활성화
        ▼
   600대 폰보드
        │
        │ WiFi 연결 (5GHz)
        ▼
   EAP670 AP × 6대
        │
        │ PoE 스위치 경유
        ▼
   관리 서버 (ADB Manager)
        │
        │ uiautomator2 명령
        ▼
   YouTube 자동화 실행
```

---

## 체크리스트

### 구매 전
- [ ] TP-Link EAP670 재고 확인
- [ ] Ryzen 7 7700X 호환 메인보드 재확인
- [ ] 서버랙/경량랙 규격 측정 완료

### 설치 시
- [ ] 전기 배선 용량 확인 (총 2kW 이상)
- [ ] 접지 상태 확인
- [ ] 환기/냉각 시스템 준비

### 설정 시
- [ ] Omada Controller 설치
- [ ] VLAN 설정 완료
- [ ] DHCP 예약 목록 작성
- [ ] xiaowei 프로그램 API 확인

---

*문서 작성일: 2024년*
*버전: 1.0*
