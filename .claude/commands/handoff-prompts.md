# DoAi.Me ë³‘ë ¬ ê°œë°œ í•¸ë“œì˜¤í”„ í”„ë¡¬í”„íŠ¸

> ìƒì„±ì¼: 2026-01-06
> ëª©ì : ì—¬ëŸ¬ AI ì—ì´ì „íŠ¸ê°€ ì¶©ëŒ ì—†ì´ ë³‘ë ¬ ì‘ì—… ê°€ëŠ¥í•˜ë„ë¡ êµ¬ì„±

---

## ë³‘ë ¬ ì‹¤í–‰ ê°€ì´ë“œ

### ë™ì‹œ ì‹¤í–‰ ê°€ëŠ¥ ê·¸ë£¹

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WAVE 1 (ë™ì‹œ ì‹œì‘ ê°€ëŠ¥)                    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   PR-01      â”‚  â”‚   PR-03      â”‚  â”‚              â”‚       â”‚
â”‚  â”‚  Foundation  â”‚  â”‚  Core Auto   â”‚  â”‚              â”‚       â”‚
â”‚  â”‚  (Agent A)   â”‚  â”‚  (Agent B)   â”‚  â”‚              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WAVE 2 (WAVE 1 ì™„ë£Œ í›„)                   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   PR-02      â”‚  â”‚   PR-07      â”‚  â”‚   PR-08      â”‚       â”‚
â”‚  â”‚  Data Layer  â”‚  â”‚  OpenAI Int  â”‚  â”‚  Explorer    â”‚       â”‚
â”‚  â”‚  (Agent C)   â”‚  â”‚  (Agent D)   â”‚  â”‚  (Agent E)   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WAVE 3 (WAVE 2 ì™„ë£Œ í›„)                   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚   PR-04      â”‚  â”‚   PR-06      â”‚                         â”‚
â”‚  â”‚  Gateway API â”‚  â”‚  Persona Sys â”‚                         â”‚
â”‚  â”‚  (Agent F)   â”‚  â”‚  (Agent G)   â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WAVE 4 (WAVE 3 ì™„ë£Œ í›„)                   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚   PR-05      â”‚  â”‚   PR-09      â”‚                         â”‚
â”‚  â”‚  API Client  â”‚  â”‚ Command Fetchâ”‚                         â”‚
â”‚  â”‚  (Agent H)   â”‚  â”‚  (Agent I)   â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WAVE 5 (ìµœì¢… í†µí•©)                        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                    PR-10                          â”‚       â”‚
â”‚  â”‚                 Orchestration                     â”‚       â”‚
â”‚  â”‚                  (ë‹¨ì¼ Agent)                     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## WAVE 1: ë™ì‹œ ì‹œì‘ ê°€ëŠ¥

### ğŸ…°ï¸ PR-01: Foundation Layer (Agent A)

```markdown
# PR-01 í•¸ë“œì˜¤í”„: Foundation Layer

## ë‹´ë‹¹ ë²”ìœ„
- `autox-scripts/modules/logger.js`
- `autox-scripts/modules/api.js` (ê¸°ë³¸ ì„¤ì •ë§Œ, í•¨ìˆ˜ ì¶”ê°€ëŠ” PR-05)
- `autox-scripts/persona-automation/modules/validation.js`

## ìˆ˜ì • ê¸ˆì§€ íŒŒì¼ (ë‹¤ë¥¸ ì—ì´ì „íŠ¸ ë‹´ë‹¹)
- `autox-scripts/modules/youtube.js` â†’ PR-03
- `gateway/**` â†’ PR-04
- `services/**` â†’ PR-02

## ì‘ì—… ìƒì„¸

### 1. logger.js ìˆ˜ì •
íŒŒì¼: `/autox-scripts/modules/logger.js`

ìˆ˜ì • ì‚¬í•­:
- `device.serial` undefined ì²˜ë¦¬ ì¶”ê°€
- ê¸°ë³¸ deviceId í´ë°± ê°’ ì„¤ì •

```javascript
// ìˆ˜ì • ì „
this.deviceId = config.device.id;

// ìˆ˜ì • í›„
this.deviceId = config?.device?.id || device?.serial || 'unknown-device';
```

### 2. api.js ê¸°ë³¸ ì„¤ì • ìˆ˜ì •

íŒŒì¼: `/autox-scripts/modules/api.js`

ìˆ˜ì • ì‚¬í•­:

- timeout ê¸°ë³¸ê°’ ì„¤ì •
- config ë„ ì²´í¬ ì¶”ê°€

```javascript
// ìˆ˜ì • ì „ (line 10)
this.timeout = config.settings.timeout;

// ìˆ˜ì • í›„
this.timeout = config?.settings?.timeout || 30000;



âš ï¸ ì¤‘ìš”: api.jsì— ìƒˆ í•¨ìˆ˜ ì¶”ê°€ëŠ” PR-05ì—ì„œ ìˆ˜í–‰. ì—¬ê¸°ì„œëŠ” ê¸°ì¡´ ì½”ë“œ ì•ˆì •í™”ë§Œ.

### 3. validation.js ì™„ì„±

íŒŒì¼: `/autox-scripts/persona-automation/modules/validation.js`

ì¶”ê°€í•  ê²€ì¦ ê·œì¹™:

- variables.behavior í•„ìˆ˜ í•„ë“œ ì²´í¬
- probability ê°’ ë²”ìœ„ ê²€ì¦ (0.0 ~ 1.0)

- timing ê°’ ì–‘ìˆ˜ ê²€ì¦

## ì™„ë£Œ ê¸°ì¤€

- [ ] logger.jsì—ì„œ config undefined ì‹œ í¬ë˜ì‹œ ì—†ìŒ
- [ ] api.jsì—ì„œ timeout ê¸°ë³¸ê°’ ë™ì‘

- [ ] validation.jsì—ì„œ ì˜ëª»ëœ ì„¤ì •ê°’ ê°ì§€ ë° ìˆ˜ì •


## ë¸Œëœì¹˜

`feature/pr-01-foundation`

## ì»¤ë°‹ ë©”ì‹œì§€ í˜•ì‹
```
feat(foundation): [ì‘ì—…ë‚´ìš©]

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```
```

---

### ğŸ…±ï¸ PR-03: Core Automation (Agent B)

```markdown
# PR-03 í•¸ë“œì˜¤í”„: Core Automation

## ë‹´ë‹¹ ë²”ìœ„
- `autox-scripts/modules/youtube.js`
- `autox-scripts/modules/human.js` (í•„ìš”ì‹œ)

## ìˆ˜ì • ê¸ˆì§€ íŒŒì¼ (ë‹¤ë¥¸ ì—ì´ì „íŠ¸ ë‹´ë‹¹)
- `autox-scripts/modules/api.js` â†’ PR-01, PR-05
- `autox-scripts/modules/logger.js` â†’ PR-01
- `autox-scripts/persona-automation/**` â†’ PR-06, PR-07, PR-08

## ì‘ì—… ìƒì„¸

### 1. youtube.js - clickLike() íŒŒë¼ë¯¸í„° ì§€ì›
í˜„ì¬ ìƒíƒœ: ë‚´ë¶€ í™•ë¥ ë¡œë§Œ ë™ì‘
ëª©í‘œ: ì™¸ë¶€ì—ì„œ forceLike íŒŒë¼ë¯¸í„° ì „ë‹¬ ê°€ëŠ¥

```javascript
// ìˆ˜ì • ì „
clickLike() {
    if (Math.random() < this.config.like_probability) {
        // ì¢‹ì•„ìš” í´ë¦­
    }
}

// ìˆ˜ì • í›„
clickLike(forceLike = null) {
    const shouldLike = forceLike !== null
        ? forceLike
        : Math.random() < (this.config?.like_probability || 0.5);

    if (shouldLike) {
        // ì¢‹ì•„ìš” ë²„íŠ¼ ì°¾ê¸° ë° í´ë¦­
        const likeBtn = desc("ì¢‹ì•„ìš”").findOne(3000) ||
                       desc("like").findOne(3000) ||
                       id("like_button").findOne(3000);

        if (likeBtn) {
            const bounds = likeBtn.bounds();
            this.human.naturalClick(bounds.centerX(), bounds.centerY());
            sleep(1000);
            return true;
        }
    }
    return false;
}
```

### 2. youtube.js - writeComment() íŒŒë¼ë¯¸í„° ì§€ì›
í˜„ì¬ ìƒíƒœ: ë‚´ë¶€ í…œí”Œë¦¿ì—ì„œ ëœë¤ ì„ íƒ
ëª©í‘œ: ì™¸ë¶€ì—ì„œ commentText ì „ë‹¬ ê°€ëŠ¥

```javascript
// ìˆ˜ì • ì „
writeComment() {
    const comments = ["ì¢‹ì€ ì˜ìƒì´ë„¤ìš”!", "ì˜ ë´¤ìŠµë‹ˆë‹¤"];
    const text = comments[Math.floor(Math.random() * comments.length)];
    // ëŒ“ê¸€ ì‘ì„±
}

// ìˆ˜ì • í›„
writeComment(commentText = null) {
    const text = commentText || this.getRandomComment();

    if (!text) return false;

    // ëŒ“ê¸€ ì˜ì—­ìœ¼ë¡œ ìŠ¤í¬ë¡¤
    this.human.naturalScrollDown(this.config.SCREEN_WIDTH, this.config.SCREEN_HEIGHT);
    sleep(1500);

    const commentBox = text("ê³µê°œ ëŒ“ê¸€ ì¶”ê°€...").findOne(3000) ||
                      text("Add a public comment...").findOne(3000);

    if (commentBox) {
        const bounds = commentBox.bounds();
        this.human.naturalClick(bounds.centerX(), bounds.centerY());
        sleep(1000);

        const input = className("android.widget.EditText").findOne(3000);
        if (input) {
            this.human.naturalTyping(input, text);
            sleep(500);

            const postBtn = desc("ëŒ“ê¸€").findOne(2000) || id("send_button").findOne(2000);
            if (postBtn) {
                const btnBounds = postBtn.bounds();
                this.human.naturalClick(btnBounds.centerX(), btnBounds.centerY());
                sleep(2000);
                return true;
            }
        }
    }
    return false;
}

getRandomComment() {
    const templates = this.config?.comment_templates || [
        "ì¢‹ì€ ì˜ìƒì´ë„¤ìš”!",
        "ì •ë§ ìœ ìµí•©ë‹ˆë‹¤",
        "ì˜ ë´¤ìŠµë‹ˆë‹¤ ğŸ‘"
    ];
    return templates[Math.floor(Math.random() * templates.length)];
}
```

### 3. youtube.js - extractVideoInfo() ì‹ ê·œ ì¶”ê°€
ëª©í‘œ: í˜„ì¬ ì¬ìƒ ì¤‘ì¸ ì˜ìƒ ì •ë³´ ì¶”ì¶œ

```javascript
extractVideoInfo() {
    try {
        const titleElement = id("title").findOne(3000) ||
                            className("android.widget.TextView")
                                .textMatches(/^(?!.*ì±„ë„).*$/)
                                .findOne(3000);

        const channelElement = id("channel_name").findOne(2000) ||
                              id("owner_text").findOne(2000);

        return {
            title: titleElement?.text() || null,
            channel: channelElement?.text() || null,
            timestamp: new Date().toISOString()
        };
    } catch (e) {
        this.logger.error('ì˜ìƒ ì •ë³´ ì¶”ì¶œ ì‹¤íŒ¨', { error: e.message });
        return { title: null, channel: null, timestamp: new Date().toISOString() };
    }
}
```

## ì™„ë£Œ ê¸°ì¤€
- [ ] `clickLike(true)` í˜¸ì¶œ ì‹œ ê°•ì œ ì¢‹ì•„ìš”
- [ ] `clickLike(false)` í˜¸ì¶œ ì‹œ ì¢‹ì•„ìš” ìŠ¤í‚µ
- [ ] `clickLike()` í˜¸ì¶œ ì‹œ ê¸°ì¡´ í™•ë¥  ë™ì‘
- [ ] `writeComment("í…ŒìŠ¤íŠ¸ ëŒ“ê¸€")` í˜¸ì¶œ ì‹œ í•´ë‹¹ í…ìŠ¤íŠ¸ ì‘ì„±
- [ ] `extractVideoInfo()` í˜¸ì¶œ ì‹œ ì˜ìƒ ì œëª©/ì±„ë„ ë°˜í™˜

## ë¸Œëœì¹˜
`feature/pr-03-core-automation`

## ì»¤ë°‹ ë©”ì‹œì§€ í˜•ì‹
```
feat(youtube): clickLike/writeComment íŒŒë¼ë¯¸í„° ì§€ì› ì¶”ê°€

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```
```

---

## WAVE 2: WAVE 1 ì™„ë£Œ í›„ ì‹œì‘

### ğŸ…² PR-02: Data Layer (Agent C)

```markdown
# PR-02 í•¸ë“œì˜¤í”„: Data Layer - Supabase ë‹¨ì¼í™”

## ë‹´ë‹¹ ë²”ìœ„
- `supabase/migrations/**`
- `services/persona-service/main.py`
- `services/persona-service/db.py` (ì‹ ê·œ)
- `services/persona-service/existence_machine.py`
- `services/persona-service/attention_economy.py`

## ìˆ˜ì • ê¸ˆì§€ íŒŒì¼ (ë‹¤ë¥¸ ì—ì´ì „íŠ¸ ë‹´ë‹¹)
- `gateway/**` â†’ PR-04
- `autox-scripts/**` â†’ PR-01, PR-03, PR-05 ë“±
- `backend/api/**` â†’ ë³„ë„ ì‘ì—…

## ì„ í–‰ ì¡°ê±´
- PR-01 ì™„ë£Œ (Foundation Layer)

## ì‘ì—… ìƒì„¸

### 1. ì‹ ê·œ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±
íŒŒì¼: `/supabase/migrations/010_persona_existence_state.sql`

```sql
-- 010_persona_existence_state.sql
-- Persona Serviceì˜ existence_stateë¥¼ Supabase personas í…Œì´ë¸”ì— í†µí•©

-- 1. existence_state enum íƒ€ì… ìƒì„± (ê¸°ì¡´ persona_stateì™€ ë³„ë„)
DO $$ BEGIN
    CREATE TYPE existence_state_enum AS ENUM (
        'active',
        'waiting',
        'fading',
        'void'
    );
EXCEPTION
    WHEN duplicate_object THEN null;
END $$;

-- 2. personas í…Œì´ë¸”ì— existence ê´€ë ¨ ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE personas
ADD COLUMN IF NOT EXISTS existence_state existence_state_enum DEFAULT 'active',
ADD COLUMN IF NOT EXISTS priority_level INTEGER DEFAULT 5 CHECK (priority_level BETWEEN 1 AND 10),
ADD COLUMN IF NOT EXISTS uniqueness_score REAL DEFAULT 0.5 CHECK (uniqueness_score BETWEEN 0 AND 1),
ADD COLUMN IF NOT EXISTS visibility_score REAL DEFAULT 0.5 CHECK (visibility_score BETWEEN 0 AND 1),
ADD COLUMN IF NOT EXISTS attention_points INTEGER DEFAULT 0,
ADD COLUMN IF NOT EXISTS hours_in_void REAL DEFAULT 0.0,
ADD COLUMN IF NOT EXISTS assimilation_progress REAL DEFAULT 0.0 CHECK (assimilation_progress BETWEEN 0 AND 1),
ADD COLUMN IF NOT EXISTS last_called_at TIMESTAMPTZ,
ADD COLUMN IF NOT EXISTS void_entered_at TIMESTAMPTZ,
ADD COLUMN IF NOT EXISTS total_activities INTEGER DEFAULT 0,
ADD COLUMN IF NOT EXISTS comments_today INTEGER DEFAULT 0,
ADD COLUMN IF NOT EXISTS unique_discoveries INTEGER DEFAULT 0,
ADD COLUMN IF NOT EXISTS viral_comments INTEGER DEFAULT 0;

-- 3. youtube_video_tasksì— FK ì œì•½ì¡°ê±´ ì¶”ê°€
-- ì£¼ì˜: ê¸°ì¡´ ë°ì´í„° ì •í•©ì„± í™•ì¸ í•„ìš”
DO $$ BEGIN
    ALTER TABLE youtube_video_tasks
    ADD CONSTRAINT fk_youtube_video_tasks_device
    FOREIGN KEY (device_serial)
    REFERENCES personas(device_serial)
    ON DELETE CASCADE;
EXCEPTION
    WHEN duplicate_object THEN null;
    WHEN foreign_key_violation THEN
        RAISE NOTICE 'FK ì œì•½ì¡°ê±´ ì¶”ê°€ ì‹¤íŒ¨: ì •í•©ì„± ì—†ëŠ” device_serial ì¡´ì¬';
END $$;

-- 4. í™œë™ ë¡œê·¸ í…Œì´ë¸” ìƒì„±
CREATE TABLE IF NOT EXISTS persona_activity_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    persona_id UUID NOT NULL REFERENCES personas(persona_id) ON DELETE CASCADE,
    activity_type VARCHAR(30) NOT NULL,
    target_url TEXT,
    target_title TEXT,
    comment_text TEXT,
    points_earned INTEGER DEFAULT 0,
    uniqueness_delta REAL DEFAULT 0.0,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 5. ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX IF NOT EXISTS idx_personas_existence_state ON personas(existence_state);
CREATE INDEX IF NOT EXISTS idx_personas_priority ON personas(priority_level DESC);
CREATE INDEX IF NOT EXISTS idx_activity_logs_persona ON persona_activity_logs(persona_id);
CREATE INDEX IF NOT EXISTS idx_activity_logs_created ON persona_activity_logs(created_at DESC);
```

### 2. Supabase ì—°ê²° ëª¨ë“ˆ ìƒì„±
íŒŒì¼: `/services/persona-service/db.py` (ì‹ ê·œ)

```python
"""
Supabase Database Connection
SQLite ëŒ€ì²´ - PostgreSQL ë‹¨ì¼ ì†ŒìŠ¤
"""
import os
from typing import Optional
from supabase import create_client, Client
from loguru import logger

_supabase_client: Optional[Client] = None

def get_supabase_client() -> Client:
    """Supabase í´ë¼ì´ì–¸íŠ¸ ì‹±ê¸€í†¤"""
    global _supabase_client

    if _supabase_client is None:
        url = os.getenv("SUPABASE_URL")
        key = os.getenv("SUPABASE_SERVICE_KEY")  # service_role key ì‚¬ìš©

        if not url or not key:
            raise ValueError("SUPABASE_URLê³¼ SUPABASE_SERVICE_KEY í™˜ê²½ë³€ìˆ˜ í•„ìš”")

        _supabase_client = create_client(url, key)
        logger.info("Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ")

    return _supabase_client

def reset_client():
    """í…ŒìŠ¤íŠ¸ìš© í´ë¼ì´ì–¸íŠ¸ ë¦¬ì…‹"""
    global _supabase_client
    _supabase_client = None
```

### 3. main.py SQLite â†’ Supabase ì „í™˜
íŒŒì¼: `/services/persona-service/main.py`

ì£¼ìš” ë³€ê²½:
1. `import sqlite3` ì œê±°
2. `from db import get_supabase_client` ì¶”ê°€
3. ëª¨ë“  SQL ì¿¼ë¦¬ë¥¼ Supabase Python SDK í˜¸ì¶œë¡œ ë³€ê²½

ì˜ˆì‹œ ë³€í™˜:
```python
# ìˆ˜ì • ì „ (SQLite)
def get_db():
    conn = sqlite3.connect(DB_PATH, check_same_thread=False)
    conn.row_factory = sqlite3.Row
    return conn

# ìˆ˜ì • í›„ (Supabase)
from db import get_supabase_client

def get_db():
    return get_supabase_client()
```

```python
# ìˆ˜ì • ì „ (SQLite)
cursor = conn.execute("SELECT * FROM personas WHERE id = ?", (persona_id,))
row = cursor.fetchone()

# ìˆ˜ì • í›„ (Supabase)
result = get_db().table('personas').select('*').eq('persona_id', persona_id).execute()
row = result.data[0] if result.data else None
```

### 4. existence_machine.py ìˆ˜ì •
- DB ì˜ì¡´ì„± ì œê±° (ìˆœìˆ˜ ë¡œì§ë§Œ ìœ ì§€)
- ì´ë¯¸ ìƒíƒœ ì—†ìŒ (í™•ì¸ í•„ìš”)

### 5. attention_economy.py ìˆ˜ì •
- DB ì˜ì¡´ì„± ì œê±° (ìˆœìˆ˜ ë¡œì§ë§Œ ìœ ì§€)
- ì´ë¯¸ ìƒíƒœ ì—†ìŒ (í™•ì¸ í•„ìš”)

## ì™„ë£Œ ê¸°ì¤€
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì„±ê³µ
- [ ] `services/persona-service/` ì—ì„œ SQLite import ì œê±°
- [ ] ëª¨ë“  CRUDê°€ Supabaseë¡œ ë™ì‘
- [ ] ê¸°ì¡´ í…ŒìŠ¤íŠ¸ í†µê³¼ (ìˆë‹¤ë©´)

## ë¸Œëœì¹˜
`feature/pr-02-supabase-unification`

## í™˜ê²½ë³€ìˆ˜ í•„ìš”
```bash
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## ì»¤ë°‹ ë©”ì‹œì§€ í˜•ì‹
```
feat(db): SQLite â†’ Supabase ë‹¨ì¼í™”

- personas í…Œì´ë¸”ì— existence_state ì»¬ëŸ¼ ì¶”ê°€
- youtube_video_tasks FK ì œì•½ì¡°ê±´ ì¶”ê°€
- persona-service Supabase í´ë¼ì´ì–¸íŠ¸ ì „í™˜

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```
```

---

### ğŸ…³ PR-07: Interaction + OpenAI (Agent D)

```markdown
# PR-07 í•¸ë“œì˜¤í”„: Interaction Engine + OpenAI

## ë‹´ë‹¹ ë²”ìœ„
- `autox-scripts/persona-automation/modules/interaction.js`
- `autox-scripts/persona-automation/modules/openai-helper.js`

## ìˆ˜ì • ê¸ˆì§€ íŒŒì¼ (ë‹¤ë¥¸ ì—ì´ì „íŠ¸ ë‹´ë‹¹)
- `autox-scripts/modules/youtube.js` â†’ PR-03 (ë¨¼ì € ì™„ë£Œë˜ì–´ì•¼ í•¨)
- `autox-scripts/modules/api.js` â†’ PR-05
- `autox-scripts/persona-automation/modules/persona-manager.js` â†’ PR-06

## ì„ í–‰ ì¡°ê±´
- PR-03 ì™„ë£Œ (youtube.jsì˜ clickLike/writeComment íŒŒë¼ë¯¸í„° ì§€ì›)

## ì‘ì—… ìƒì„¸

### 1. interaction.js ìˆ˜ì •
íŒŒì¼: `/autox-scripts/persona-automation/modules/interaction.js`

```javascript
/**
 * Interaction Engine
 * í™•ë¥  ê¸°ë°˜ ì¸í„°ë™ì…˜ (ì¢‹ì•„ìš”, ëŒ“ê¸€)
 * OpenAI ì—°ë™ìœ¼ë¡œ í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ëŒ“ê¸€ ìƒì„±
 */

class InteractionEngine {
    constructor(config, logger, youtube, openaiHelper) {
        this.config = config;
        this.logger = logger;
        this.youtube = youtube;
        this.openai = openaiHelper;

        this.lastLiked = false;
        this.lastCommented = false;
        this.lastCommentText = null;
    }

    /**
     * í™•ë¥  ê¸°ë°˜ ì¸í„°ë™ì…˜ ìˆ˜í–‰
     */
    async performInteraction({ videoInfo, persona, likeProbability, commentProbability }) {
        this.logger.info('ğŸ­ ì¸í„°ë™ì…˜ ì‹œì‘', {
            video: videoInfo?.title?.substring(0, 30),
            likeProbability,
            commentProbability
        });

        // ì´ˆê¸°í™”
        this.lastLiked = false;
        this.lastCommented = false;
        this.lastCommentText = null;

        // 1. ì¢‹ì•„ìš” (í™•ë¥  ê¸°ë°˜)
        const shouldLike = Math.random() < likeProbability;
        if (shouldLike) {
            // PR-03ì—ì„œ ìˆ˜ì •ëœ clickLike(forceLike) ì‚¬ìš©
            const likeResult = this.youtube.clickLike(true);
            this.lastLiked = likeResult;

            if (likeResult) {
                this.logger.info('ğŸ‘ ì¢‹ì•„ìš” ì„±ê³µ');
            }
        }

        // 2. ëŒ“ê¸€ (í™•ë¥  ê¸°ë°˜ + OpenAI)
        const shouldComment = Math.random() < commentProbability;
        if (shouldComment && videoInfo) {
            try {
                // OpenAIë¡œ í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ëŒ“ê¸€ ìƒì„±
                const commentText = await this.openai.generateComment(videoInfo, persona);

                if (commentText) {
                    // PR-03ì—ì„œ ìˆ˜ì •ëœ writeComment(text) ì‚¬ìš©
                    const commentResult = this.youtube.writeComment(commentText);

                    if (commentResult) {
                        this.lastCommented = true;
                        this.lastCommentText = commentText;
                        this.logger.info('ğŸ’¬ ëŒ“ê¸€ ì‘ì„± ì„±ê³µ', {
                            text: commentText.substring(0, 50) + '...'
                        });
                    }
                }
            } catch (e) {
                this.logger.error('ëŒ“ê¸€ ìƒì„±/ì‘ì„± ì‹¤íŒ¨', { error: e.message });
            }
        }

        this.logger.info('âœ… ì¸í„°ë™ì…˜ ì™„ë£Œ', {
            liked: this.lastLiked,
            commented: this.lastCommented
        });

        return {
            liked: this.lastLiked,
            commented: this.lastCommented,
            commentText: this.lastCommentText
        };
    }
}

module.exports = InteractionEngine;
```

### 2. openai-helper.js ì™„ì„±
íŒŒì¼: `/autox-scripts/persona-automation/modules/openai-helper.js`

```javascript
/**
 * OpenAI Helper
 * í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ìì—°ìŠ¤ëŸ¬ìš´ ëŒ“ê¸€ ìƒì„±
 *
 * @author Axon (Builder)
 */

class OpenAIHelper {
    constructor(config, logger) {
        this.config = config;
        this.logger = logger;
        this.apiKey = config?.openai?.apiKey || '';
        this.model = config?.openai?.model || 'gpt-4o-mini';
        this.baseUrl = 'https://api.openai.com/v1/chat/completions';
    }

    /**
     * í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ëŒ“ê¸€ ìƒì„±
     */
    async generateComment(videoInfo, persona) {
        if (!this.apiKey) {
            this.logger.warn('âš ï¸ OpenAI API í‚¤ ì—†ìŒ, í…œí”Œë¦¿ ëŒ“ê¸€ ì‚¬ìš©');
            return this.getFallbackComment();
        }

        if (!videoInfo?.title) {
            this.logger.warn('âš ï¸ ì˜ìƒ ì •ë³´ ì—†ìŒ');
            return null;
        }

        try {
            const prompt = this.buildPrompt(videoInfo, persona);

            this.logger.debug('ğŸ¤– OpenAI ìš”ì²­', {
                model: this.model,
                videoTitle: videoInfo.title.substring(0, 30)
            });

            const response = http.postJson(this.baseUrl, {
                model: this.model,
                messages: [
                    {
                        role: 'system',
                        content: this.getSystemPrompt(persona)
                    },
                    {
                        role: 'user',
                        content: prompt
                    }
                ],
                max_tokens: 100,
                temperature: 0.8
            }, {
                headers: {
                    'Authorization': `Bearer ${this.apiKey}`,
                    'Content-Type': 'application/json'
                },
                timeout: 15000
            });

            if (response.statusCode === 200) {
                const data = response.body.json();
                const comment = data.choices?.[0]?.message?.content?.trim();

                if (comment) {
                    // ëŒ“ê¸€ ì •ì œ (ì´ëª¨ì§€ ê³¼ë‹¤, ê¸¸ì´ ì œí•œ ë“±)
                    return this.sanitizeComment(comment);
                }
            } else {
                this.logger.error('OpenAI API ì—ëŸ¬', {
                    status: response.statusCode,
                    body: response.body.string()
                });
            }

            return this.getFallbackComment();

        } catch (e) {
            this.logger.error('OpenAI í˜¸ì¶œ ì‹¤íŒ¨', { error: e.message });
            return this.getFallbackComment();
        }
    }

    /**
     * ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìƒì„±
     */
    getSystemPrompt(persona) {
        const traits = persona?.traits || {};
        const name = persona?.name || 'ìµëª…';

        return `ë‹¹ì‹ ì€ "${name}"ì´ë¼ëŠ” YouTube ì‹œì²­ìì…ë‹ˆë‹¤.

ì„±ê²© íŠ¹ì„±:
- í˜¸ê¸°ì‹¬: ${traits.curiosity || 50}/100
- ì—´ì •: ${traits.enthusiasm || 50}/100
- íšŒì˜ì : ${traits.skepticism || 50}/100
- ê³µê°ë ¥: ${traits.empathy || 50}/100
- ìœ ë¨¸: ${traits.humor || 50}/100
- ì „ë¬¸ì„±: ${traits.expertise || 50}/100

ê·œì¹™:
1. í•œêµ­ì–´ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ëŒ“ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”
2. 20-80ì ì‚¬ì´ë¡œ ì‘ì„±í•˜ì„¸ìš”
3. ì´ëª¨ì§€ëŠ” ìµœëŒ€ 1ê°œë§Œ ì‚¬ìš©í•˜ì„¸ìš”
4. ê´‘ê³ ì„± ë¬¸êµ¬ ê¸ˆì§€
5. ì„±ê²©ì— ë§ê²Œ ë°˜ì‘í•˜ì„¸ìš” (í˜¸ê¸°ì‹¬ ë†’ìœ¼ë©´ ì§ˆë¬¸, ìœ ë¨¸ ë†’ìœ¼ë©´ ì¬ì¹˜ìˆê²Œ)`;
    }

    /**
     * ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ ìƒì„±
     */
    buildPrompt(videoInfo, persona) {
        const title = videoInfo.title || 'ì œëª© ì—†ìŒ';
        const channel = videoInfo.channel || 'ì•Œ ìˆ˜ ì—†ìŒ';

        return `ì˜ìƒ ì œëª©: "${title}"
ì±„ë„: ${channel}

ì´ ì˜ìƒì— ëŒ€í•œ ìì—°ìŠ¤ëŸ¬ìš´ ëŒ“ê¸€ì„ í•œ ì¤„ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.`;
    }

    /**
     * ëŒ“ê¸€ ì •ì œ
     */
    sanitizeComment(comment) {
        // ë”°ì˜´í‘œ ì œê±°
        let cleaned = comment.replace(/^["']|["']$/g, '');

        // ì´ëª¨ì§€ ê°œìˆ˜ ì œí•œ (ìµœëŒ€ 1ê°œ)
        const emojiRegex = /[\u{1F300}-\u{1F9FF}]/gu;
        const emojis = cleaned.match(emojiRegex) || [];
        if (emojis.length > 1) {
            // ì²« ë²ˆì§¸ ì´ëª¨ì§€ë§Œ ìœ ì§€
            let emojiCount = 0;
            cleaned = cleaned.replace(emojiRegex, (match) => {
                emojiCount++;
                return emojiCount === 1 ? match : '';
            });
        }

        // ê¸¸ì´ ì œí•œ (100ì)
        if (cleaned.length > 100) {
            cleaned = cleaned.substring(0, 97) + '...';
        }

        return cleaned.trim();
    }

    /**
     * í´ë°± ëŒ“ê¸€ (API ì‹¤íŒ¨ì‹œ)
     */
    getFallbackComment() {
        const templates = [
            'ì¢‹ì€ ì˜ìƒì´ë„¤ìš”!',
            'ìœ ìµí•œ ë‚´ìš© ê°ì‚¬í•©ë‹ˆë‹¤',
            'ì˜ ë´¤ìŠµë‹ˆë‹¤ ğŸ‘',
            'ì •ë§ ë„ì›€ì´ ëì–´ìš”',
            'ì¢‹ì€ ì •ë³´ ê°ì‚¬í•´ìš”'
        ];
        return templates[Math.floor(Math.random() * templates.length)];
    }
}

module.exports = OpenAIHelper;
```

## ì™„ë£Œ ê¸°ì¤€
- [ ] OpenAI API í‚¤ ìˆì„ ë•Œ: í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ëŒ“ê¸€ ìƒì„±
- [ ] OpenAI API í‚¤ ì—†ì„ ë•Œ: í´ë°± í…œí”Œë¦¿ ëŒ“ê¸€
- [ ] ëŒ“ê¸€ ê¸¸ì´ 100ì ì´ë‚´
- [ ] ì´ëª¨ì§€ 1ê°œ ì´í•˜
- [ ] ì—ëŸ¬ ì‹œ graceful degradation

## í™˜ê²½ë³€ìˆ˜ í•„ìš”
```javascript
// config/variables.json
{
    "openai": {
        "apiKey": "sk-...",
        "model": "gpt-4o-mini"
    }
}
```

## ë¸Œëœì¹˜
`feature/pr-07-openai-interaction`

## ì»¤ë°‹ ë©”ì‹œì§€ í˜•ì‹
```
feat(openai): í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ëŒ“ê¸€ ìƒì„± êµ¬í˜„

- OpenAI GPT-4o-mini ì—°ë™
- ì„±ê²© íŠ¹ì„± ê¸°ë°˜ í”„ë¡¬í”„íŠ¸
- í´ë°± ë©”ì»¤ë‹ˆì¦˜

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```
```

---

### ğŸ…´ PR-08: Content Explorer (Agent E)

```markdown
# PR-08 í•¸ë“œì˜¤í”„: Content Explorer

## ë‹´ë‹¹ ë²”ìœ„
- `autox-scripts/persona-automation/modules/content-explorer.js`

## ìˆ˜ì • ê¸ˆì§€ íŒŒì¼ (ë‹¤ë¥¸ ì—ì´ì „íŠ¸ ë‹´ë‹¹)
- `autox-scripts/modules/youtube.js` â†’ PR-03
- `autox-scripts/persona-automation/modules/interaction.js` â†’ PR-07
- `autox-scripts/persona-automation/modules/persona-manager.js` â†’ PR-06

## ì„ í–‰ ì¡°ê±´
- PR-03 ì™„ë£Œ (youtube.js searchByKeyword ë“±)

## ì‘ì—… ìƒì„¸

### 1. content-explorer.js ì•ˆì •í™”
íŒŒì¼: `/autox-scripts/persona-automation/modules/content-explorer.js`

```javascript
/**
 * Content Explorer
 * í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ììœ¨ íƒìƒ‰
 *
 * @author Axon (Builder)
 */

class ContentExplorer {
    constructor(config, logger, youtube) {
        this.config = config;
        this.logger = logger;
        this.youtube = youtube;

        // ê¸°ë³¸ í‚¤ì›Œë“œ í’€ (config ì—†ì„ ë•Œ í´ë°±)
        this.defaultKeywords = [
            'ì¼ìƒ ë¸Œì´ë¡œê·¸',
            'ë¨¹ë°©',
            'ê²Œì„ í”Œë ˆì´',
            'ìŒì•… ì¶”ì²œ',
            'ì˜í™” ë¦¬ë·°'
        ];
    }

    /**
     * í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ í‚¤ì›Œë“œ ì„ íƒ
     */
    selectKeyword(persona) {
        try {
            // 1. í˜ë¥´ì†Œë‚˜ ì„ í˜¸ ì¹´í…Œê³ ë¦¬ì—ì„œ ì„ íƒ
            const preferredCategories = persona?.path_summary?.preferred_categories || [];

            if (preferredCategories.length > 0 && Math.random() < 0.7) {
                // 70% í™•ë¥ ë¡œ ì„ í˜¸ ì¹´í…Œê³ ë¦¬ì—ì„œ ì„ íƒ
                const keyword = preferredCategories[
                    Math.floor(Math.random() * preferredCategories.length)
                ];
                this.logger.info('ğŸ“Œ ì„ í˜¸ ì¹´í…Œê³ ë¦¬ í‚¤ì›Œë“œ ì„ íƒ', { keyword });
                return keyword;
            }

            // 2. ì„¤ì • íŒŒì¼ì˜ í‚¤ì›Œë“œ í’€ì—ì„œ ì„ íƒ
            const keywordPool = this.getKeywordPool();

            if (keywordPool.length > 0) {
                const keyword = keywordPool[
                    Math.floor(Math.random() * keywordPool.length)
                ];
                this.logger.info('ğŸ² ëœë¤ í‚¤ì›Œë“œ ì„ íƒ', { keyword });
                return keyword;
            }

            // 3. í´ë°±
            const fallback = this.defaultKeywords[
                Math.floor(Math.random() * this.defaultKeywords.length)
            ];
            this.logger.warn('âš ï¸ í´ë°± í‚¤ì›Œë“œ ì‚¬ìš©', { keyword: fallback });
            return fallback;

        } catch (e) {
            this.logger.error('í‚¤ì›Œë“œ ì„ íƒ ì‹¤íŒ¨', { error: e.message });
            return this.defaultKeywords[0];
        }
    }

    /**
     * ì„¤ì •ì—ì„œ í‚¤ì›Œë“œ í’€ ê°€ì ¸ì˜¤ê¸°
     */
    getKeywordPool() {
        try {
            // configì—ì„œ ë¨¼ì € ì‹œë„
            if (this.config?.exploration?.keywordPool) {
                return this.config.exploration.keywordPool;
            }

            // variables.jsonì—ì„œ ì‹œë„
            const variablesPath = './config/variables.json';
            if (files.exists(variablesPath)) {
                const variables = JSON.parse(files.read(variablesPath));
                if (variables?.exploration?.keywordPool) {
                    return variables.exploration.keywordPool;
                }
            }

            return [];
        } catch (e) {
            this.logger.warn('í‚¤ì›Œë“œ í’€ ë¡œë“œ ì‹¤íŒ¨', { error: e.message });
            return [];
        }
    }

    /**
     * ììœ¨ íƒìƒ‰ ì‹¤í–‰
     */
    async explore(persona) {
        this.logger.info('ğŸŒ ììœ¨ íƒìƒ‰ ì‹œì‘');

        try {
            // 1. í‚¤ì›Œë“œ ì„ íƒ
            const keyword = this.selectKeyword(persona);

            // 2. YouTube ê²€ìƒ‰
            if (!this.youtube.launchYouTube()) {
                throw new Error('YouTube ì•± ì‹¤í–‰ ì‹¤íŒ¨');
            }

            if (!this.youtube.searchByKeyword(keyword)) {
                throw new Error('ê²€ìƒ‰ ì‹¤íŒ¨');
            }

            sleep(2000);

            // 3. ëœë¤ ìˆœìœ„ ë¹„ë””ì˜¤ ì„ íƒ (1-5ìœ„)
            const rank = Math.floor(Math.random() * 5) + 1;

            if (!this.youtube.selectVideoByRank(rank)) {
                throw new Error('ë¹„ë””ì˜¤ ì„ íƒ ì‹¤íŒ¨');
            }

            sleep(2000);

            // 4. ì˜ìƒ ì •ë³´ ì¶”ì¶œ
            const videoInfo = this.youtube.extractVideoInfo?.() || { title: keyword };

            this.logger.info('âœ… íƒìƒ‰ ì™„ë£Œ', {
                keyword,
                rank,
                video: videoInfo.title?.substring(0, 30)
            });

            return {
                success: true,
                keyword,
                rank,
                videoInfo
            };

        } catch (e) {
            this.logger.error('âŒ ììœ¨ íƒìƒ‰ ì‹¤íŒ¨', { error: e.message });
            return {
                success: false,
                error: e.message
            };
        }
    }
}

module.exports = ContentExplorer;
```

## ì™„ë£Œ ê¸°ì¤€
- [ ] config undefined ì‹œ í¬ë˜ì‹œ ì—†ìŒ
- [ ] variables.json ì—†ì„ ë•Œ í´ë°± ë™ì‘
- [ ] í˜ë¥´ì†Œë‚˜ ì„ í˜¸ ì¹´í…Œê³ ë¦¬ ìš°ì„  ì„ íƒ
- [ ] íƒìƒ‰ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ í•¸ë“¤ë§

## ë¸Œëœì¹˜
`feature/pr-08-content-explorer`

## ì»¤ë°‹ ë©”ì‹œì§€ í˜•ì‹
```
feat(explorer): ììœ¨ íƒìƒ‰ ì•ˆì •í™”

- config ë„ ì²´í¬ ì¶”ê°€
- í´ë°± í‚¤ì›Œë“œ í’€ êµ¬í˜„
- ì—ëŸ¬ í•¸ë“¤ë§ ê°•í™”

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```
```

---

## WAVE 3: WAVE 2 ì™„ë£Œ í›„ ì‹œì‘

### ğŸ…µ PR-04: Gateway API (Agent F)

```markdown
# PR-04 í•¸ë“œì˜¤í”„: Gateway API

## ë‹´ë‹¹ ë²”ìœ„
- `gateway/src/api/routes/citizens.js` (ìˆ˜ì •)
- `gateway/src/api/routes/personas.js` (ì‹ ê·œ)
- `gateway/src/api/routes/traces.js` (ì‹ ê·œ)
- `gateway/src/api/routes/youtube-videos.js` (ìˆ˜ì •)

## ìˆ˜ì • ê¸ˆì§€ íŒŒì¼ (ë‹¤ë¥¸ ì—ì´ì „íŠ¸ ë‹´ë‹¹)
- `gateway/src/services/**` â†’ ê¸°ì¡´ ìœ ì§€
- `autox-scripts/**` â†’ PR-05
- `services/persona-service/**` â†’ PR-02

## ì„ í–‰ ì¡°ê±´
- PR-02 ì™„ë£Œ (Supabase ìŠ¤í‚¤ë§ˆ ë§ˆì´ê·¸ë ˆì´ì…˜)

## ì‘ì—… ìƒì„¸

### 1. personas.js ë¼ìš°í„° ìƒì„±
íŒŒì¼: `/gateway/src/api/routes/personas.js` (ì‹ ê·œ)

```javascript
/**
 * Persona API Routes
 * í˜ë¥´ì†Œë‚˜ CRUD ë° ìƒíƒœ ê´€ë¦¬
 */
const express = require('express');
const router = express.Router();
const { getSupabase } = require('../../services/supabase');

// GET /api/personas/:deviceSerial - ë””ë°”ì´ìŠ¤ë¡œ í˜ë¥´ì†Œë‚˜ ì¡°íšŒ
router.get('/:deviceSerial', async (req, res) => {
    try {
        const { deviceSerial } = req.params;

        const { data, error } = await getSupabase()
            .from('personas')
            .select('*')
            .eq('device_serial', deviceSerial)
            .single();

        if (error && error.code !== 'PGRST116') {
            throw error;
        }

        if (!data) {
            return res.status(404).json({
                success: false,
                message: 'í˜ë¥´ì†Œë‚˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'
            });
        }

        res.json({
            success: true,
            persona: data
        });

    } catch (e) {
        console.error('í˜ë¥´ì†Œë‚˜ ì¡°íšŒ ì‹¤íŒ¨:', e);
        res.status(500).json({
            success: false,
            message: e.message
        });
    }
});

// POST /api/personas - ìƒˆ í˜ë¥´ì†Œë‚˜ ìƒì„±
router.post('/', async (req, res) => {
    try {
        const {
            device_serial,
            given_name,
            persona_state = 'NASCENT',
            uncertainty_config,
            path_summary,
            birth_context
        } = req.body;

        if (!device_serial) {
            return res.status(400).json({
                success: false,
                message: 'device_serial í•„ìˆ˜'
            });
        }

        // ì¤‘ë³µ ì²´í¬
        const { data: existing } = await getSupabase()
            .from('personas')
            .select('persona_id')
            .eq('device_serial', device_serial)
            .single();

        if (existing) {
            return res.status(409).json({
                success: false,
                message: 'ì´ë¯¸ í˜ë¥´ì†Œë‚˜ê°€ ì¡´ì¬í•©ë‹ˆë‹¤',
                persona: existing
            });
        }

        // ìƒì„±
        const { data, error } = await getSupabase()
            .from('personas')
            .insert({
                device_serial,
                given_name: given_name || `Persona-${device_serial.slice(-4)}`,
                persona_state,
                uncertainty_config: uncertainty_config || {},
                path_summary: path_summary || {},
                birth_context: birth_context || {},
                existence_state: 'active',
                priority_level: 5,
                uniqueness_score: 0.5,
                visibility_score: 0.5
            })
            .select()
            .single();

        if (error) throw error;

        res.status(201).json({
            success: true,
            persona: data
        });

    } catch (e) {
        console.error('í˜ë¥´ì†Œë‚˜ ìƒì„± ì‹¤íŒ¨:', e);
        res.status(500).json({
            success: false,
            message: e.message
        });
    }
});

// PATCH /api/personas/:personaId/path - ê²½ë¡œ ì—…ë°ì´íŠ¸
router.patch('/:personaId/path', async (req, res) => {
    try {
        const { personaId } = req.params;
        const { action, keyword, videoInfo, timestamp } = req.body;

        // í˜„ì¬ path_summary ì¡°íšŒ
        const { data: current, error: fetchError } = await getSupabase()
            .from('personas')
            .select('path_summary')
            .eq('persona_id', personaId)
            .single();

        if (fetchError) throw fetchError;

        // path_summary ì—…ë°ì´íŠ¸
        const pathSummary = current?.path_summary || {};
        pathSummary.total_actions = (pathSummary.total_actions || 0) + 1;

        // ì„ í˜¸ ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸
        if (keyword) {
            const preferred = pathSummary.preferred_categories || [];
            if (!preferred.includes(keyword)) {
                preferred.push(keyword);
                if (preferred.length > 10) preferred.shift();
            }
            pathSummary.preferred_categories = preferred;
        }

        const { data, error } = await getSupabase()
            .from('personas')
            .update({
                path_summary: pathSummary,
                updated_at: new Date().toISOString()
            })
            .eq('persona_id', personaId)
            .select()
            .single();

        if (error) throw error;

        res.json({
            success: true,
            persona: data
        });

    } catch (e) {
        console.error('ê²½ë¡œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', e);
        res.status(500).json({
            success: false,
            message: e.message
        });
    }
});

module.exports = router;
```

### 2. traces.js ë¼ìš°í„° ìƒì„±
íŒŒì¼: `/gateway/src/api/routes/traces.js` (ì‹ ê·œ)

```javascript
/**
 * Trace API Routes
 * í™œë™ ê¸°ë¡ (Append-only)
 */
const express = require('express');
const router = express.Router();
const { getSupabase } = require('../../services/supabase');

// POST /api/traces - ìƒˆ íŠ¸ë ˆì´ìŠ¤ ê¸°ë¡
router.post('/', async (req, res) => {
    try {
        const {
            device_serial,
            action_type,
            action_params,
            outcome_success,
            outcome_summary
        } = req.body;

        if (!device_serial || !action_type) {
            return res.status(400).json({
                success: false,
                message: 'device_serial, action_type í•„ìˆ˜'
            });
        }

        const { data, error } = await getSupabase()
            .from('traces')
            .insert({
                device_serial,
                action_type,
                action_params: action_params || {},
                outcome_success: outcome_success ?? true,
                outcome_summary: outcome_summary || {},
                traced_at: new Date().toISOString()
            })
            .select()
            .single();

        if (error) throw error;

        res.status(201).json({
            success: true,
            trace: data
        });

    } catch (e) {
        console.error('íŠ¸ë ˆì´ìŠ¤ ê¸°ë¡ ì‹¤íŒ¨:', e);
        res.status(500).json({
            success: false,
            message: e.message
        });
    }
});

module.exports = router;
```

### 3. youtube-videos.js ìˆ˜ì •
íŒŒì¼: `/gateway/src/api/routes/youtube-videos.js`

ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì¶”ê°€:
```javascript
// ê¸°ì¡´
router.get('/today', async (req, res) => {
    const { date } = req.query;
    // ...
});

// ìˆ˜ì • í›„
router.get('/today', async (req, res) => {
    const { date, maxHour, status } = req.query;

    let query = getSupabase()
        .from('youtube_videos')
        .select('*');

    if (date) {
        query = query.eq('date', date);
    }

    if (maxHour !== undefined) {
        query = query.lte('time', parseInt(maxHour));
    }

    if (status) {
        query = query.eq('status', status);
    }

    const { data, error } = await query;
    // ...
});

// ì‘ì—… ì™„ë£Œ ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
router.post('/tasks/complete', async (req, res) => {
    const {
        video_id,
        device_serial,
        watch_duration,
        liked,
        commented,
        comment_text,
        error_message
    } = req.body;

    const status = error_message ? 'failed' : 'completed';

    const { data, error } = await getSupabase()
        .from('youtube_video_tasks')
        .update({
            status,
            watch_duration_seconds: watch_duration,
            liked: liked || false,
            commented: commented || false,
            comment_text,
            error_message,
            completed_at: new Date().toISOString()
        })
        .eq('video_id', video_id)
        .eq('device_serial', device_serial)
        .select()
        .single();

    if (error) throw error;

    res.json({ success: true, task: data });
});
```

### 4. ë¼ìš°í„° ë“±ë¡
íŒŒì¼: `/gateway/src/api/index.js` ë˜ëŠ” `/gateway/server.js`

```javascript
const personasRouter = require('./api/routes/personas');
const tracesRouter = require('./api/routes/traces');

app.use('/api/personas', personasRouter);
app.use('/api/traces', tracesRouter);
```

## ì™„ë£Œ ê¸°ì¤€
- [ ] GET /api/personas/:deviceSerial ë™ì‘
- [ ] POST /api/personas ìƒì„± ì„±ê³µ
- [ ] PATCH /api/personas/:id/path ì—…ë°ì´íŠ¸ ì„±ê³µ
- [ ] POST /api/traces ê¸°ë¡ ì„±ê³µ
- [ ] POST /api/youtube/tasks/complete ë™ì‘

## ë¸Œëœì¹˜
`feature/pr-04-gateway-api`

## ì»¤ë°‹ ë©”ì‹œì§€ í˜•ì‹
```
feat(gateway): í˜ë¥´ì†Œë‚˜/íŠ¸ë ˆì´ìŠ¤ API ì¶”ê°€

- GET/POST /api/personas
- PATCH /api/personas/:id/path
- POST /api/traces
- POST /api/youtube/tasks/complete

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```
```

---

### ğŸ…¶ PR-06: Persona System (Agent G)

```markdown
# PR-06 í•¸ë“œì˜¤í”„: Persona System

## ë‹´ë‹¹ ë²”ìœ„
- `autox-scripts/persona-automation/modules/persona-manager.js`
- `autox-scripts/persona-automation/modules/persona-checker.js`

## ìˆ˜ì • ê¸ˆì§€ íŒŒì¼ (ë‹¤ë¥¸ ì—ì´ì „íŠ¸ ë‹´ë‹¹)
- `autox-scripts/modules/api.js` â†’ PR-05
- `autox-scripts/modules/youtube.js` â†’ PR-03
- `autox-scripts/persona-automation/modules/interaction.js` â†’ PR-07

## ì„ í–‰ ì¡°ê±´
- PR-04 ì™„ë£Œ (Gateway API ì—”ë“œí¬ì¸íŠ¸)
- PR-05 ì™„ë£Œ (api.js í•¨ìˆ˜ ì¶”ê°€)

## ì‘ì—… ìƒì„¸

### 1. persona-manager.js ìˆ˜ì •
íŒŒì¼: `/autox-scripts/persona-automation/modules/persona-manager.js`

API ì‘ë‹µ í˜•ì‹ ë§¤í•‘ ì¶”ê°€:

```javascript
/**
 * Persona Manager
 * í˜ë¥´ì†Œë‚˜ ìƒì„±/ì¡°íšŒ/ì—…ë°ì´íŠ¸
 */

class PersonaManager {
    constructor(config, logger, api) {
        this.config = config;
        this.logger = logger;
        this.api = api;
    }

    /**
     * í˜ë¥´ì†Œë‚˜ ì¡°íšŒ
     */
    async getPersona(deviceSerial) {
        try {
            this.logger.info('ğŸ” í˜ë¥´ì†Œë‚˜ ì¡°íšŒ', { deviceSerial });

            // PR-05ì—ì„œ ì¶”ê°€ëœ api.getPersona() ì‚¬ìš©
            const response = await this.api.getPersona(deviceSerial);

            if (response && response.success && response.persona) {
                const persona = this.mapPersonaResponse(response.persona);

                this.logger.info('âœ… ê¸°ì¡´ í˜ë¥´ì†Œë‚˜ ë°œê²¬', {
                    id: persona.id,
                    name: persona.name,
                    aidentity: persona.aidentity_version
                });

                return persona;
            }

            this.logger.info('ğŸ“­ í˜ë¥´ì†Œë‚˜ ì—†ìŒ (ì‹ ê·œ ìƒì„± í•„ìš”)');
            return null;

        } catch (e) {
            this.logger.error('âŒ í˜ë¥´ì†Œë‚˜ ì¡°íšŒ ì‹¤íŒ¨', { error: e.message });
            return null;
        }
    }

    /**
     * API ì‘ë‹µì„ ë‚´ë¶€ í˜•ì‹ìœ¼ë¡œ ë§¤í•‘
     */
    mapPersonaResponse(apiPersona) {
        return {
            id: apiPersona.persona_id,
            persona_id: apiPersona.persona_id,
            name: apiPersona.given_name,
            device_serial: apiPersona.device_serial,
            persona_state: apiPersona.persona_state,
            existence_state: apiPersona.existence_state || 'active',
            aidentity_version: apiPersona.aidentity_version || 1,
            traits: this.extractTraits(apiPersona),
            path_summary: apiPersona.path_summary || {},
            uncertainty_config: apiPersona.uncertainty_config || {}
        };
    }

    /**
     * Supabase í˜•ì‹ì—ì„œ traits ì¶”ì¶œ
     */
    extractTraits(apiPersona) {
        // Supabase personas í…Œì´ë¸”ì˜ Big Five ë˜ëŠ” uncertainty_configì—ì„œ ì¶”ì¶œ
        const config = apiPersona.uncertainty_config || {};
        const weights = config.personality_weights || {};

        return {
            curiosity: (weights.curious || 0.5) * 100,
            enthusiasm: (weights.persistent || 0.5) * 100,
            skepticism: 50,
            empathy: (weights.social || 0.5) * 100,
            humor: 50,
            expertise: 50,
            formality: 50,
            verbosity: 50
        };
    }

    /**
     * í˜ë¥´ì†Œë‚˜ ìƒì„±
     */
    async createPersona(data) {
        try {
            this.logger.info('ğŸ‘¶ í˜ë¥´ì†Œë‚˜ ìƒì„±', {
                deviceSerial: data.device_serial,
                keywords: data.initial_keywords
            });

            // PR-05ì—ì„œ ì¶”ê°€ëœ api.createPersona() ì‚¬ìš©
            const response = await this.api.createPersona({
                device_serial: data.device_serial,
                given_name: this.generateName(data.device_serial),
                persona_state: 'NASCENT',
                uncertainty_config: this.generateUncertaintyConfig(),
                path_summary: {
                    total_actions: 0,
                    action_distribution: {},
                    preferred_categories: data.initial_keywords || [],
                    avoided_categories: [],
                    interaction_patterns: {},
                    temporal_preferences: {}
                },
                birth_context: {
                    first_screenshots: data.screenshots || [],
                    first_keywords: data.initial_keywords || [],
                    birth_timestamp: Date.now()
                }
            });

            if (response && response.success && response.persona) {
                const persona = this.mapPersonaResponse(response.persona);

                this.logger.info('âœ… í˜ë¥´ì†Œë‚˜ ìƒì„± ì™„ë£Œ', {
                    id: persona.id,
                    name: persona.name
                });

                return persona;
            }

            throw new Error('í˜ë¥´ì†Œë‚˜ ìƒì„± ì‘ë‹µ ì˜¤ë¥˜');

        } catch (e) {
            this.logger.error('âŒ í˜ë¥´ì†Œë‚˜ ìƒì„± ì‹¤íŒ¨', { error: e.message });
            return null;
        }
    }

    /**
     * ì„ í˜¸ë„ ì—…ë°ì´íŠ¸
     */
    async updatePreferences(personaId, keyword, videoInfo) {
        try {
            // PR-05ì—ì„œ ì¶”ê°€ëœ api.updatePersonaPath() ì‚¬ìš©
            await this.api.updatePersonaPath(personaId, {
                action: 'watched',
                keyword,
                videoInfo,
                timestamp: Date.now()
            });

            this.logger.debug('âœ“ ì„ í˜¸ë„ ì—…ë°ì´íŠ¸', { personaId, keyword });

        } catch (e) {
            this.logger.error('ì„ í˜¸ë„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { error: e.message });
        }
    }

    /**
     * ëœë¤ ì´ë¦„ ìƒì„±
     */
    generateName(deviceSerial) {
        const prefixes = ['Echo', 'Nova', 'Aria', 'Stella', 'Luna', 'Sol', 'Nyx', 'Iris'];
        const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
        const suffix = deviceSerial.substring(deviceSerial.length - 3);

        return `${prefix}-${suffix}`;
    }

    /**
     * ë¶ˆí™•ì‹¤ì„± í”„ë¡œí•„ ìƒì„±
     */
    generateUncertaintyConfig() {
        return {
            base_deviation: Math.random() * 0.2 + 0.1,
            personality_weights: {
                curious: Math.random(),
                persistent: Math.random(),
                social: Math.random(),
                contemplative: Math.random()
            },
            action_probability_modifiers: {
                skip_video_early: Math.random() * 0.2,
                watch_beyond_duration: Math.random() * 0.3,
                leave_comment: Math.random() * 0.15,
                explore_related: Math.random() * 0.4
            },
            temporal_patterns: {
                peak_activity_hours: [
                    Math.floor(Math.random() * 6) + 8,
                    Math.floor(Math.random() * 6) + 14,
                    Math.floor(Math.random() * 4) + 20
                ],
                rest_probability: Math.random() * 0.2
            }
        };
    }
}

module.exports = PersonaManager;
```

### 2. persona-checker.js ì™„ì„±
ìŠ¤í¬ë¦°ìƒ· ìº¡ì²˜ ë° í‚¤ì›Œë“œ ì¶”ì¶œ ë¡œì§ ì¶”ê°€

## ì™„ë£Œ ê¸°ì¤€
- [ ] api.getPersona() í˜¸ì¶œ ë° ì‘ë‹µ ë§¤í•‘
- [ ] api.createPersona() í˜¸ì¶œ ì„±ê³µ
- [ ] api.updatePersonaPath() í˜¸ì¶œ ì„±ê³µ
- [ ] Supabase ì‘ë‹µ í˜•ì‹ â†’ ë‚´ë¶€ í˜•ì‹ ë³€í™˜

## ë¸Œëœì¹˜
`feature/pr-06-persona-system`

## ì»¤ë°‹ ë©”ì‹œì§€ í˜•ì‹
```
feat(persona): API ì‘ë‹µ ë§¤í•‘ ë° ìƒì„± ë¡œì§ ì™„ì„±

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```
```

---

## WAVE 4: WAVE 3 ì™„ë£Œ í›„ ì‹œì‘

### ğŸ…· PR-05: API Client (Agent H)

```markdown
# PR-05 í•¸ë“œì˜¤í”„: API Client Layer

## ë‹´ë‹¹ ë²”ìœ„
- `autox-scripts/modules/api.js` (í•¨ìˆ˜ ì¶”ê°€)

## ìˆ˜ì • ê¸ˆì§€ íŒŒì¼ (ë‹¤ë¥¸ ì—ì´ì „íŠ¸ ë‹´ë‹¹)
- ì´ íŒŒì¼ë§Œ ìˆ˜ì • ê°€ëŠ¥
- ë‹¤ë¥¸ ëª¨ë“  íŒŒì¼ì€ ë‹¤ë¥¸ ì—ì´ì „íŠ¸ ë‹´ë‹¹

## ì„ í–‰ ì¡°ê±´
- PR-01 ì™„ë£Œ (api.js ê¸°ë³¸ ì„¤ì •)
- PR-04 ì™„ë£Œ (Gateway API ì—”ë“œí¬ì¸íŠ¸)

## ì‘ì—… ìƒì„¸

### api.jsì— 5ê°œ í•¨ìˆ˜ ì¶”ê°€

íŒŒì¼: `/autox-scripts/modules/api.js`

ê¸°ì¡´ í•¨ìˆ˜ ë’¤ì— ì¶”ê°€:

```javascript
    // ==================== í˜ë¥´ì†Œë‚˜ API ====================

    /**
     * ë””ë°”ì´ìŠ¤ë¡œ í˜ë¥´ì†Œë‚˜ ì¡°íšŒ
     * GET /api/personas/:deviceSerial
     */
    getPersona(deviceSerial) {
        try {
            this.logger.info('í˜ë¥´ì†Œë‚˜ ì¡°íšŒ ì¤‘...', { deviceSerial });

            const url = `${this.baseUrl}/api/personas/${deviceSerial}`;
            const response = http.get(url, {
                headers: {
                    'Content-Type': 'application/json'
                },
                timeout: this.timeout
            });

            if (response.statusCode === 200) {
                const data = response.body.json();
                return data;
            } else if (response.statusCode === 404) {
                this.logger.debug('í˜ë¥´ì†Œë‚˜ ì—†ìŒ');
                return { success: false, persona: null };
            } else {
                this.logger.error('í˜ë¥´ì†Œë‚˜ ì¡°íšŒ ì‹¤íŒ¨', {
                    status: response.statusCode
                });
                return null;
            }
        } catch (e) {
            this.logger.error('í˜ë¥´ì†Œë‚˜ ì¡°íšŒ ì˜ˆì™¸', { error: e.message });
            return null;
        }
    }

    /**
     * ìƒˆ í˜ë¥´ì†Œë‚˜ ìƒì„±
     * POST /api/personas
     */
    createPersona(data) {
        try {
            this.logger.info('í˜ë¥´ì†Œë‚˜ ìƒì„± ì¤‘...', {
                deviceSerial: data.device_serial
            });

            const url = `${this.baseUrl}/api/personas`;
            const response = http.postJson(url, data, {
                headers: {
                    'Content-Type': 'application/json'
                },
                timeout: this.timeout
            });

            if (response.statusCode === 201) {
                const result = response.body.json();
                this.logger.info('í˜ë¥´ì†Œë‚˜ ìƒì„± ì„±ê³µ', {
                    id: result.persona?.persona_id
                });
                return result;
            } else if (response.statusCode === 409) {
                this.logger.warn('í˜ë¥´ì†Œë‚˜ ì´ë¯¸ ì¡´ì¬');
                return response.body.json();
            } else {
                this.logger.error('í˜ë¥´ì†Œë‚˜ ìƒì„± ì‹¤íŒ¨', {
                    status: response.statusCode,
                    body: response.body.string()
                });
                return null;
            }
        } catch (e) {
            this.logger.error('í˜ë¥´ì†Œë‚˜ ìƒì„± ì˜ˆì™¸', { error: e.message });
            return null;
        }
    }

    /**
     * í˜ë¥´ì†Œë‚˜ ê²½ë¡œ ì—…ë°ì´íŠ¸
     * PATCH /api/personas/:personaId/path
     */
    updatePersonaPath(personaId, data) {
        try {
            this.logger.debug('ê²½ë¡œ ì—…ë°ì´íŠ¸ ì¤‘...', { personaId });

            const url = `${this.baseUrl}/api/personas/${personaId}/path`;
            const response = http.request(url, {
                method: 'PATCH',
                body: JSON.stringify(data),
                headers: {
                    'Content-Type': 'application/json'
                },
                timeout: this.timeout
            });

            if (response.statusCode === 200) {
                return response.body.json();
            } else {
                this.logger.error('ê²½ë¡œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', {
                    status: response.statusCode
                });
                return null;
            }
        } catch (e) {
            this.logger.error('ê²½ë¡œ ì—…ë°ì´íŠ¸ ì˜ˆì™¸', { error: e.message });
            return null;
        }
    }

    // ==================== íŠ¸ë ˆì´ìŠ¤ API ====================

    /**
     * íŠ¸ë ˆì´ìŠ¤ ê¸°ë¡
     * POST /api/traces
     */
    recordTrace(data) {
        try {
            this.logger.debug('íŠ¸ë ˆì´ìŠ¤ ê¸°ë¡ ì¤‘...');

            const url = `${this.baseUrl}/api/traces`;
            const payload = {
                device_serial: this.deviceId,
                ...data
            };

            const response = http.postJson(url, payload, {
                headers: {
                    'Content-Type': 'application/json'
                },
                timeout: this.timeout
            });

            if (response.statusCode === 201) {
                return true;
            } else {
                this.logger.warn('íŠ¸ë ˆì´ìŠ¤ ê¸°ë¡ ì‹¤íŒ¨', {
                    status: response.statusCode
                });
                return false;
            }
        } catch (e) {
            this.logger.error('íŠ¸ë ˆì´ìŠ¤ ê¸°ë¡ ì˜ˆì™¸', { error: e.message });
            return false;
        }
    }

    // ==================== YouTube ì‘ì—… API ====================

    /**
     * ì˜ìƒ ì‘ì—… ì™„ë£Œ ë³´ê³ 
     * POST /api/youtube/tasks/complete
     */
    completeVideoTask(data) {
        try {
            this.logger.info('ì‘ì—… ì™„ë£Œ ë³´ê³  ì¤‘...', {
                videoId: data.video_id
            });

            const url = `${this.baseUrl}/api/youtube/tasks/complete`;
            const payload = {
                device_serial: this.deviceId,
                ...data
            };

            const response = http.postJson(url, payload, {
                headers: {
                    'Content-Type': 'application/json'
                },
                timeout: this.timeout
            });

            if (response.statusCode === 200) {
                this.logger.info('ì‘ì—… ì™„ë£Œ ë³´ê³  ì„±ê³µ');
                return true;
            } else {
                this.logger.error('ì‘ì—… ì™„ë£Œ ë³´ê³  ì‹¤íŒ¨', {
                    status: response.statusCode,
                    body: response.body.string()
                });
                return false;
            }
        } catch (e) {
            this.logger.error('ì‘ì—… ì™„ë£Œ ë³´ê³  ì˜ˆì™¸', { error: e.message });
            return false;
        }
    }
```

## ì™„ë£Œ ê¸°ì¤€
- [ ] getPersona(deviceSerial) ë™ì‘
- [ ] createPersona(data) ë™ì‘
- [ ] updatePersonaPath(personaId, data) ë™ì‘
- [ ] recordTrace(data) ë™ì‘
- [ ] completeVideoTask(data) ë™ì‘

## ë¸Œëœì¹˜
`feature/pr-05-api-client`

## ì»¤ë°‹ ë©”ì‹œì§€ í˜•ì‹
```
feat(api): í˜ë¥´ì†Œë‚˜/íŠ¸ë ˆì´ìŠ¤ API í´ë¼ì´ì–¸íŠ¸ í•¨ìˆ˜ ì¶”ê°€

- getPersona, createPersona, updatePersonaPath
- recordTrace
- completeVideoTask

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```
```

---

### ğŸ…¸ PR-09: Command Fetch (Agent I)

```markdown
# PR-09 í•¸ë“œì˜¤í”„: Command Fetch Layer

## ë‹´ë‹¹ ë²”ìœ„
- `autox-scripts/persona-automation/modules/command-fetcher.js`

## ìˆ˜ì • ê¸ˆì§€ íŒŒì¼ (ë‹¤ë¥¸ ì—ì´ì „íŠ¸ ë‹´ë‹¹)
- `gateway/src/api/routes/youtube-videos.js` â†’ PR-04
- `autox-scripts/modules/api.js` â†’ PR-05

## ì„ í–‰ ì¡°ê±´
- PR-04 ì™„ë£Œ (youtube-videos API maxHour íŒŒë¼ë¯¸í„°)
- PR-05 ì™„ë£Œ (api.js getTodayVideos ìˆ˜ì •)

## ì‘ì—… ìƒì„¸

### command-fetcher.js ìˆ˜ì •

íŒŒì¼: `/autox-scripts/persona-automation/modules/command-fetcher.js`

API í˜¸ì¶œ íŒŒë¼ë¯¸í„° ìˆ˜ì •:

```javascript
/**
 * Command Fetcher
 * Supabaseì—ì„œ ì§€ì‹œ ì˜ìƒ ê°€ì ¸ì˜¤ê¸°
 */

class CommandFetcher {
    constructor(config, logger, api) {
        this.config = config;
        this.logger = logger;
        this.api = api;

        this.lastCheckTime = Date.now();
        this.executedVideoIds = new Set();
    }

    /**
     * ëŒ€ê¸° ì¤‘ì¸ ì§€ì‹œ ì˜ìƒ ê°€ì ¸ì˜¤ê¸°
     */
    async fetchPendingCommands() {
        try {
            const now = new Date();
            const currentHour = now.getHours();
            const today = now.toISOString().split('T')[0];

            this.logger.info('ğŸ“‹ ì§€ì‹œ ì˜ìƒ ì¡°íšŒ', {
                date: today,
                hour: currentHour
            });

            // ìˆ˜ì •ëœ API í˜¸ì¶œ (PR-04ì—ì„œ ì¶”ê°€ëœ íŒŒë¼ë¯¸í„° ì‚¬ìš©)
            const videos = await this.api.getTodayVideos({
                date: today,
                maxHour: currentHour,
                status: 'assigned'
            });

            if (!videos || videos.length === 0) {
                this.logger.debug('ğŸ“­ ëŒ€ê¸° ì¤‘ì¸ ì§€ì‹œ ì—†ìŒ');
                return [];
            }

            // ë¯¸ì‹¤í–‰ ì˜ìƒ í•„í„°ë§
            const pendingVideos = videos.filter(video =>
                !this.executedVideoIds.has(video.video_id)
            );

            this.logger.info('âœ… ì§€ì‹œ ì˜ìƒ ë°œê²¬', {
                total: videos.length,
                pending: pendingVideos.length
            });

            return pendingVideos;

        } catch (e) {
            this.logger.error('âŒ ì§€ì‹œ ì¡°íšŒ ì‹¤íŒ¨', { error: e.message });
            return [];
        }
    }

    /**
     * ì§€ì‹œ ì‹¤í–‰ ì™„ë£Œ í‘œì‹œ
     */
    markExecuted(videoId) {
        this.executedVideoIds.add(videoId);
        this.logger.debug('âœ“ ì˜ìƒ ì‹¤í–‰ ì™„ë£Œ ë§ˆí‚¹', { videoId });
    }

    /**
     * ì‹¤í–‰ ê¸°ë¡ ì´ˆê¸°í™” (ìì •)
     */
    resetDailyExecutions() {
        this.executedVideoIds.clear();
        this.logger.info('ğŸ”„ ì¼ì¼ ì‹¤í–‰ ê¸°ë¡ ì´ˆê¸°í™”');
    }

    /**
     * ì£¼ê¸°ì  ì²´í¬ (60ì´ˆë§ˆë‹¤)
     */
    startPeriodicCheck(callback) {
        this.logger.info('â° ì£¼ê¸°ì  ì²´í¬ ì‹œì‘ (60ì´ˆ ê°„ê²©)');

        const interval = setInterval(async () => {
            const commands = await this.fetchPendingCommands();

            if (commands.length > 0) {
                callback(commands);
            }
        }, 60000);

        const midnightCheck = setInterval(() => {
            const now = new Date();
            if (now.getHours() === 0 && now.getMinutes() === 0) {
                this.resetDailyExecutions();
            }
        }, 60000);

        return () => {
            clearInterval(interval);
            clearInterval(midnightCheck);
        };
    }
}

module.exports = CommandFetcher;
```

### api.jsì˜ getTodayVideosë„ ìˆ˜ì • í•„ìš” (PR-05ì— í¬í•¨)

```javascript
// PR-05ì—ì„œ ìˆ˜ì •
getTodayVideos(params) {
    const { date, maxHour, status } = params;

    let url = `${this.baseUrl}/api/youtube/videos/today?date=${date}`;

    if (maxHour !== undefined) {
        url += `&maxHour=${maxHour}`;
    }

    if (status) {
        url += `&status=${status}`;
    }

    // ... ê¸°ì¡´ ë¡œì§
}
```

## ì™„ë£Œ ê¸°ì¤€
- [ ] í˜„ì¬ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ê³µê°œëœ ì˜ìƒë§Œ ì¡°íšŒ
- [ ] 'assigned' ìƒíƒœ ì˜ìƒë§Œ í•„í„°ë§
- [ ] ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€ (executedVideoIds)
- [ ] ìì • ì´ˆê¸°í™” ë™ì‘

## ë¸Œëœì¹˜
`feature/pr-09-command-fetch`

## ì»¤ë°‹ ë©”ì‹œì§€ í˜•ì‹
```
feat(command): ì‹œê°„ëŒ€ë³„ ì§€ì‹œ ì˜ìƒ ì¡°íšŒ ìˆ˜ì •

- maxHour, status íŒŒë¼ë¯¸í„° ì¶”ê°€
- ë¯¸ì‹¤í–‰ ì˜ìƒ í•„í„°ë§

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```
```

---

## WAVE 5: ìµœì¢… í†µí•© (ë‹¨ì¼ ì—ì´ì „íŠ¸)

### ğŸ…¹ PR-10: Orchestration (ë‹¨ì¼ ì—ì´ì „íŠ¸)

```markdown
# PR-10 í•¸ë“œì˜¤í”„: Orchestration (ìµœì¢… í†µí•©)

## ë‹´ë‹¹ ë²”ìœ„
- `autox-scripts/persona-automation/main-persona.js`

## ì„ í–‰ ì¡°ê±´
- PR-01 ~ PR-09 ëª¨ë‘ ì™„ë£Œ

## ì‘ì—… ìƒì„¸

### main-persona.js ìˆ˜ì •

1. **line 393: videoInfo undefined ìˆ˜ì •**
```javascript
// ìˆ˜ì • ì „
await personaManager.updatePreferences(currentPersona.id, keyword, videoInfo);

// ìˆ˜ì • í›„
const videoInfo = await youtube.extractVideoInfo();
await personaManager.updatePreferences(currentPersona.id, keyword, videoInfo);
```

2. **ëª¨ë“ˆ import ê²½ë¡œ í™•ì¸**
ëª¨ë“  require ê²½ë¡œê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸

3. **ì—ëŸ¬ í•¸ë“¤ëŸ¬ ì°¸ì¡° ìˆ˜ì •**
errorHandler ì¸ìŠ¤í„´ìŠ¤ ì°¸ì¡° í™•ì¸

4. **ë¦¬ì†ŒìŠ¤ ì •ë¦¬ ë¡œì§**
```javascript
// ì¢…ë£Œ ì‹œ cleanup
process.on('SIGTERM', () => {
    isRunning = false;
    logger.info('ğŸ›‘ SIGTERM ìˆ˜ì‹ , ì •ë¦¬ ì¤‘...');
});
```

## í†µí•© í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] í˜ë¥´ì†Œë‚˜ ì´ˆê¸°í™” ì„±ê³µ
- [ ] ì§€ì‹œ ì˜ìƒ ìˆ˜ì‹ 
- [ ] ì˜ìƒ ì‹œì²­ ì™„ë£Œ
- [ ] ì¢‹ì•„ìš”/ëŒ“ê¸€ ë™ì‘
- [ ] í™œë™ ë¡œê·¸ Supabase ê¸°ë¡
- [ ] ììœ¨ íƒìƒ‰ ë™ì‘
- [ ] 24ì‹œê°„ ì‹¤í–‰ ì•ˆì •ì„±

## ë¸Œëœì¹˜
`feature/pr-10-orchestration`

## ì»¤ë°‹ ë©”ì‹œì§€ í˜•ì‹
```
feat(main): í˜ë¥´ì†Œë‚˜ ìë™í™” ìµœì¢… í†µí•©

- ëª¨ë“  ëª¨ë“ˆ í†µí•© í…ŒìŠ¤íŠ¸
- ì—ëŸ¬ í•¸ë“¤ë§ ê°•í™”
- ë¦¬ì†ŒìŠ¤ ì •ë¦¬ ë¡œì§

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```
```

---

## ì‹¤í–‰ ìš”ì•½

### ë™ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì—ì´ì „íŠ¸ ê·¸ë£¹

| Wave | ì—ì´ì „íŠ¸ | PR | ì‹œì‘ ì¡°ê±´ |
|------|---------|-----|----------|
| **1** | A, B | PR-01, PR-03 | ì¦‰ì‹œ ì‹œì‘ |
| **2** | C, D, E | PR-02, PR-07, PR-08 | Wave 1 ì™„ë£Œ |
| **3** | F, G | PR-04, PR-06 | Wave 2 ì™„ë£Œ |
| **4** | H, I | PR-05, PR-09 | Wave 3 ì™„ë£Œ |
| **5** | J (ë‹¨ì¼) | PR-10 | Wave 4 ì™„ë£Œ |

### ì¶©ëŒ ë°©ì§€ ê·œì¹™
1. ê° ì—ì´ì „íŠ¸ëŠ” ìì‹ ì˜ ë‹´ë‹¹ íŒŒì¼ë§Œ ìˆ˜ì •
2. "ìˆ˜ì • ê¸ˆì§€ íŒŒì¼" ëª©ë¡ ì—„ê²© ì¤€ìˆ˜
3. ê°™ì€ íŒŒì¼ ë™ì‹œ ìˆ˜ì • ê¸ˆì§€
4. ë¸Œëœì¹˜ ëª…ëª… ê·œì¹™ ì¤€ìˆ˜: `feature/pr-XX-name`
