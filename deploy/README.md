# AIFarm ë°°í¬ ê°€ì´ë“œ v2.0

í”„ë¡ íŠ¸ì—”ë“œ(Vercel) + ë°±ì—”ë“œ(Vultr) ì™„ì „ ë°°í¬ ê°€ì´ë“œ

## ğŸ“‹ ì „ì²´ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ì‚¬ìš©ì ë¸Œë¼ìš°ì €                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vercel (í”„ë¡ íŠ¸ì—”ë“œ)                               â”‚
â”‚                    https://aifarm.vercel.app                        â”‚
â”‚                    - Next.js Dashboard                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚ HTTPS API ìš”ì²­
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vultr ì„œë²„ (ë°±ì—”ë“œ)                               â”‚
â”‚                    158.247.210.152                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Nginx (ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ)                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    FastAPI (ë°±ì—”ë“œ API)                       â”‚   â”‚
â”‚  â”‚                    - Port 8000                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Supabase (ë°ì´í„°ë² ì´ìŠ¤)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”¢ ë°°í¬ ìˆœì„œ

1. Supabase ì„¤ì • (ë°ì´í„°ë² ì´ìŠ¤)
2. Vultr ì„œë²„ ì„¤ì • (ë°±ì—”ë“œ)
3. Vercel ë°°í¬ (í”„ë¡ íŠ¸ì—”ë“œ)
4. ì—°ë™ í…ŒìŠ¤íŠ¸

---

## Phase 1: Supabase ì„¤ì •

### 1.1 í”„ë¡œì íŠ¸ ìƒì„±

1. [supabase.com](https://supabase.com) ì ‘ì† â†’ ë¡œê·¸ì¸
2. "New Project" í´ë¦­
3. ì„¤ì •:
   - **Name**: `aifarm-db`
   - **Database Password**: ê°•ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ ìƒì„± (ì €ì¥í•´ë‘ê¸°!)
   - **Region**: `Northeast Asia (ap-northeast-1)` - í•œêµ­ì—ì„œ ê°€ê¹Œì›€

### 1.2 ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìƒì„±

SQL Editorì—ì„œ `../supabase/migrations/002_full_schema.sql` íŒŒì¼ ë‚´ìš© ì‹¤í–‰

### 1.3 API í‚¤ í™•ì¸

Settings â†’ API ë©”ë‰´ì—ì„œ ë‹¤ìŒ ì •ë³´ ë³µì‚¬:
- **Project URL**: `https://xxxxx.supabase.co`
- **anon public key**: `eyJhbG...`
- **service_role key**: `eyJhbG...` (ë°±ì—”ë“œìš©, ì ˆëŒ€ ë…¸ì¶œ ê¸ˆì§€!)

---

## Phase 2: Vultr ì„œë²„ ì„¤ì •

### 2.1 SSH ì ‘ì†

```bash
ssh root@158.247.210.152
```

### 2.2 ìë™ ì„¤ì • ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (ê¶Œì¥)

```bash
# ìŠ¤í¬ë¦½íŠ¸ ë‹¤ìš´ë¡œë“œ ë° ì‹¤í–‰
curl -o setup.sh https://raw.githubusercontent.com/yourusername/aifarm/main/deploy/setup-vultr.sh
chmod +x setup.sh
./setup.sh
```

### 2.3 ìˆ˜ë™ ì„¤ì • (ì„ íƒì‚¬í•­)

```bash
# ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸
apt update && apt upgrade -y

# í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
apt install -y python3 python3-pip python3-venv nginx certbot python3-certbot-nginx git curl htop

# Node.js ì„¤ì¹˜ (PM2ìš©)
curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
apt install -y nodejs

# PM2 ì„¤ì¹˜
npm install -g pm2

# í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ ìƒì„±
mkdir -p /opt/aifarm
mkdir -p /var/log/aifarm
cd /opt/aifarm

# Python ê°€ìƒí™˜ê²½ ìƒì„±
python3 -m venv venv
source venv/bin/activate

# íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install -r requirements.txt
```

### 2.4 í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ìƒì„±

```bash
nano /opt/aifarm/.env
```

`env.example.txt` íŒŒì¼ ë‚´ìš© ì°¸ê³ í•˜ì—¬ ì‘ì„±

### 2.5 ë°±ì—”ë“œ íŒŒì¼ ë°°í¬

```bash
# main.py ë³µì‚¬
scp deploy/main.py root@158.247.210.152:/opt/aifarm/

# ë˜ëŠ” git clone
cd /opt/aifarm
git clone https://github.com/yourusername/aifarm.git .
```

### 2.6 PM2ë¡œ ë°±ì—”ë“œ ì‹¤í–‰

```bash
cd /opt/aifarm
pm2 start ecosystem.config.js
pm2 startup
pm2 save
pm2 status
```

### 2.7 Nginx ì„¤ì •

**ë„ë©”ì¸ ì—†ëŠ” ê²½ìš° (IPë§Œ ì‚¬ìš©):**

```bash
# ì„¤ì • íŒŒì¼ ë³µì‚¬
cp nginx/aifarm-ip.conf /etc/nginx/sites-available/aifarm

# í™œì„±í™”
ln -s /etc/nginx/sites-available/aifarm /etc/nginx/sites-enabled/
rm /etc/nginx/sites-enabled/default

# í…ŒìŠ¤íŠ¸ ë° ì¬ì‹œì‘
nginx -t
systemctl restart nginx
```

**ë„ë©”ì¸ì´ ìˆëŠ” ê²½ìš°:**

```bash
# SSL ì„¤ì • íŒŒì¼ ë³µì‚¬
cp nginx/aifarm-ssl.conf /etc/nginx/sites-available/aifarm

# ë„ë©”ì¸ ìˆ˜ì • í›„ í™œì„±í™”
nano /etc/nginx/sites-available/aifarm
ln -s /etc/nginx/sites-available/aifarm /etc/nginx/sites-enabled/

# SSL ì¸ì¦ì„œ ë°œê¸‰
certbot --nginx -d api.yourdomain.com

# Nginx ì¬ì‹œì‘
systemctl restart nginx
```

### 2.8 í…ŒìŠ¤íŠ¸

```bash
# ë¡œì»¬ í…ŒìŠ¤íŠ¸
curl http://localhost:8000/health

# ì™¸ë¶€ í…ŒìŠ¤íŠ¸
curl http://158.247.210.152/health
```

---

## Phase 3: Vercel ë°°í¬

### 3.1 í”„ë¡œì íŠ¸ ì¤€ë¹„

```bash
cd aifarm-dashboard

# í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ìƒì„±
echo "NEXT_PUBLIC_API_URL=http://158.247.210.152" > .env.production
```

### 3.2 GitHub ë¦¬í¬ì§€í† ë¦¬ ì—°ê²°

ì´ë¯¸ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´ ìŠ¤í‚µ

### 3.3 Vercel ë°°í¬

1. [vercel.com](https://vercel.com) ì ‘ì† â†’ ë¡œê·¸ì¸
2. "Add New Project" í´ë¦­
3. GitHub ë¦¬í¬ì§€í† ë¦¬ import
4. **Environment Variables** ì„¤ì •:
   - `NEXT_PUBLIC_API_URL`: `http://158.247.210.152`
5. "Deploy" í´ë¦­

### 3.4 í™˜ê²½ ë³€ìˆ˜ í™•ì¸

Vercel Dashboard â†’ Project Settings â†’ Environment Variables:
- `NEXT_PUBLIC_API_URL`: ë°±ì—”ë“œ URL

---

## ğŸ“‹ ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

### Supabase
- [ ] í”„ë¡œì íŠ¸ ìƒì„±
- [ ] í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ìƒì„±
- [ ] ì´ˆê¸° ë°ì´í„° ì‚½ì…
- [ ] API í‚¤ ì €ì¥

### Vultr ì„œë²„
- [ ] SSH ì ‘ì† ê°€ëŠ¥
- [ ] Python, Nginx ì„¤ì¹˜
- [ ] FastAPI ì½”ë“œ ë°°í¬
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
- [ ] PM2ë¡œ ë°±ì—”ë“œ ì‹¤í–‰
- [ ] Nginx ì„¤ì • ì™„ë£Œ
- [ ] ë°©í™”ë²½ ì„¤ì •
- [ ] `/health` ì—”ë“œí¬ì¸íŠ¸ ì‘ë‹µ í™•ì¸

### Vercel
- [ ] GitHub ë¦¬í¬ì§€í† ë¦¬ ì—°ê²°
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
- [ ] ë°°í¬ ì„±ê³µ

### í†µí•© í…ŒìŠ¤íŠ¸
- [ ] í”„ë¡ íŠ¸ì—”ë“œì—ì„œ API í˜¸ì¶œ ì„±ê³µ
- [ ] CORS ì˜¤ë¥˜ ì—†ìŒ
- [ ] ë°ì´í„° í‘œì‹œ ì •ìƒ

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### CORS ì˜¤ë¥˜

```
Access to fetch at 'http://...' from origin 'https://...' has been blocked by CORS policy
```

**í•´ê²°:**
1. FastAPI `CORS_ORIGINS`ì— í”„ë¡ íŠ¸ì—”ë“œ URL ì¶”ê°€
2. PM2 ì¬ì‹œì‘: `pm2 restart aifarm-api`

### 502 Bad Gateway

```
502 Bad Gateway - nginx
```

**í•´ê²°:**
1. FastAPI ì‹¤í–‰ í™•ì¸: `pm2 status`
2. í¬íŠ¸ í™•ì¸: `netstat -tlnp | grep 8000`
3. PM2 ë¡œê·¸ í™•ì¸: `pm2 logs aifarm-api`

### SSL ì¸ì¦ì„œ ì˜¤ë¥˜

**í•´ê²°:**
1. ë„ë©”ì¸ DNS ì„¤ì • í™•ì¸
2. ë°©í™”ë²½ì—ì„œ 80, 443 í¬íŠ¸ ì—´ê¸°
3. `certbot --nginx -d api.yourdomain.com` ì¬ì‹¤í–‰

---

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
deploy/
â”œâ”€â”€ main.py              # FastAPI ë°±ì—”ë“œ ë©”ì¸ íŒŒì¼
â”œâ”€â”€ requirements.txt     # Python íŒ¨í‚¤ì§€ ëª©ë¡
â”œâ”€â”€ ecosystem.config.js  # PM2 ì„¤ì • íŒŒì¼
â”œâ”€â”€ env.example.txt      # í™˜ê²½ ë³€ìˆ˜ ì˜ˆì‹œ
â”œâ”€â”€ setup-vultr.sh       # ìë™ ì„¤ì • ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ nginx/
â”‚   â”œâ”€â”€ aifarm-ip.conf   # Nginx ì„¤ì • (IPìš©)
â”‚   â””â”€â”€ aifarm-ssl.conf  # Nginx ì„¤ì • (SSL/ë„ë©”ì¸ìš©)
â””â”€â”€ README.md            # ì´ íŒŒì¼
```

---

## ğŸ“ ì§€ì›

ë¬¸ì œ ë°œìƒ ì‹œ:
- PM2 ë¡œê·¸: `pm2 logs aifarm-api`
- Nginx ë¡œê·¸: `tail -f /var/log/nginx/error.log`
- Vercel ë¹Œë“œ ë¡œê·¸: Vercel Dashboard â†’ Deployments

