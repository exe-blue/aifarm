============================================================
AIFarm 600대 서버 빠른 설정 가이드
============================================================

⚠️ CONFIGURATION NOTE:
This document uses placeholders for environment-specific values.
Before using, replace the following placeholders with actual values:
  - ${SERVER_IP}  : Your Vultr server IP (from deploy/deploy.env or team secret manager)
  - ${REPO_PATH}  : Local path to the aifarm repository
See deploy/HANDOFF_PROMPT.md for detailed configuration guidance.

============================================================

[1단계] SSH로 서버 접속 (SSH key authentication recommended)
------------------------------------------------------------
# Replace ${SERVER_IP} with your actual server IP from deploy/deploy.env
# Using SSH key authentication (recommended):
ssh -i ~/.ssh/id_ed25519_aifarm deploy@${SERVER_IP}

# If root access is required, use sudo on the server


[2단계] 아래 전체 블록을 복사하여 붙여넣기 (Ctrl+Shift+V)
------------------------------------------------------------

apt update && apt upgrade -y && apt install -y python3.11 python3.11-venv python3-pip git curl wget htop tmux ufw && mkdir -p /opt/aifarm && cd /opt/aifarm && python3.11 -m venv venv && source venv/bin/activate && pip install --upgrade pip && pip install fastapi uvicorn pydantic aiohttp python-dotenv jinja2 uiautomator2 supabase gspread google-auth openai tenacity Pillow && ufw allow 22/tcp && ufw allow 8080/tcp && ufw allow 5555/tcp && ufw --force enable && echo "기본 설정 완료!"


[3단계] 환경변수 설정
------------------------------------------------------------

cat > /opt/aifarm/.env << 'EOF'
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-anon-key
HOST=0.0.0.0
PORT=8080
MAX_WORKERS=100
EOF


[4단계] systemd 서비스 등록
------------------------------------------------------------

cat > /etc/systemd/system/aifarm.service << 'EOF'
[Unit]
Description=AIFarm Server
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/opt/aifarm
Environment=PATH=/opt/aifarm/venv/bin
ExecStart=/opt/aifarm/venv/bin/python run_intranet.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload
systemctl enable aifarm


[5단계] 로컬 PC에서 프로젝트 파일 업로드
------------------------------------------------------------
(새 터미널에서 실행)

# Replace ${REPO_PATH} with your local repository path (e.g., C:\projects\ai-fram or /home/user/ai-fram)
# Replace ${SERVER_IP} with your server IP from deploy/deploy.env
scp -r ${REPO_PATH}/aifarm deploy@${SERVER_IP}:/opt/


[6단계] 서비스 시작 (서버에서)
------------------------------------------------------------

systemctl start aifarm
systemctl status aifarm


[7단계] Tailscale 설치 (옵션)
------------------------------------------------------------

curl -fsSL https://tailscale.com/install.sh | sh
tailscale up --advertise-routes=10.0.0.0/8 --accept-routes


============================================================
완료 후 확인
============================================================

# Replace ${SERVER_IP} with your actual server IP from deploy/deploy.env
대시보드: http://${SERVER_IP}:8080/dashboard
헬스체크: curl http://localhost:8080/health
로그 확인: journalctl -u aifarm -f
서비스 재시작: systemctl restart aifarm

============================================================